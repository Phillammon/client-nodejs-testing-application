/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/rpc/RPCSession", ["require", "exports", "grakn-client/dependencies_internal", "graknlabs-protocol/protobuf/session_pb"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.RPCSession = void 0;
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    const session_pb_1 = __importDefault(require("graknlabs-protocol/protobuf/session_pb"));
    class RPCSession {
        constructor(grpcClient, database, type) {
            this._database = database;
            this._type = type;
            this._grpcClient = grpcClient;
        }
        open(options = new dependencies_internal_1.GraknOptions()) {
            return __awaiter(this, void 0, void 0, function* () {
                const openReq = new session_pb_1.default.Session.Open.Req()
                    .setDatabase(this._database)
                    .setType(sessionType(this._type))
                    .setOptions(dependencies_internal_1.ProtoBuilder.options(options));
                this._isOpen = true;
                const res = yield new Promise((resolve, reject) => {
                    this._grpcClient.session_open(openReq, (err, res) => {
                        if (err)
                            reject(err);
                        else
                            resolve(res);
                    });
                });
                this._sessionId = res.getSessionId_asB64();
                this._pulse = setTimeout(() => this.pulse(), 5000);
                return this;
            });
        }
        transaction(type, options = new dependencies_internal_1.GraknOptions()) {
            const transaction = new dependencies_internal_1.RPCTransaction(this._grpcClient, type);
            return transaction.open(this._sessionId, options);
        }
        type() {
            return this._type;
        }
        isOpen() {
            return this._isOpen;
        }
        close() {
            return __awaiter(this, void 0, void 0, function* () {
                if (this._isOpen) {
                    this._isOpen = false;
                    clearTimeout(this._pulse);
                    const req = new session_pb_1.default.Session.Close.Req().setSessionId(this._sessionId);
                    yield new Promise((resolve, reject) => {
                        this._grpcClient.session_close(req, (err) => {
                            if (err)
                                reject(err);
                            else
                                resolve();
                        });
                    });
                }
            });
        }
        database() {
            return this._database;
        }
        pulse() {
            if (!this._isOpen)
                return;
            const pulse = new session_pb_1.default.Session.Pulse.Req().setSessionId(this._sessionId);
            this._grpcClient.session_pulse(pulse, (err) => {
                if (err)
                    return; // Generally means the session has been closed, which is fine
                else
                    this._pulse = setTimeout(() => this.pulse(), 5000);
            });
        }
    }
    exports.RPCSession = RPCSession;
    function sessionType(type) {
        switch (type) {
            case dependencies_internal_1.Grakn.SessionType.DATA:
                return session_pb_1.default.Session.Type.DATA;
            case dependencies_internal_1.Grakn.SessionType.SCHEMA:
                return session_pb_1.default.Session.Type.SCHEMA;
            default:
                throw new dependencies_internal_1.GraknClientError(dependencies_internal_1.ErrorMessage.Client.UNRECOGNISED_SESSION_TYPE.message());
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUlBDU2Vzc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3JwYy9SUENTZXNzaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUVILDhFQUtrQztJQUdsQyx3RkFBa0U7SUFFbEUsTUFBYSxVQUFVO1FBUW5CLFlBQVksVUFBcUIsRUFBRSxRQUFnQixFQUFFLElBQXVCO1lBQ3hFLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1lBQzFCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQ2xDLENBQUM7UUFFSyxJQUFJLENBQUMsVUFBd0IsSUFBSSxvQ0FBWSxFQUFFOztnQkFDakQsTUFBTSxPQUFPLEdBQUcsSUFBSSxvQkFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO3FCQUM5QyxXQUFXLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztxQkFDM0IsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7cUJBQ2hDLFVBQVUsQ0FBQyxvQ0FBWSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUMvQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztnQkFDcEIsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLE9BQU8sQ0FBZ0MsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7b0JBQzdFLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTt3QkFDaEQsSUFBSSxHQUFHOzRCQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQzs7NEJBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDdEIsQ0FB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dGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBHcmFrbixcbiAgICBQcm90b0J1aWxkZXIsXG4gICAgR3Jha25PcHRpb25zLFxuICAgIFJQQ1RyYW5zYWN0aW9uLCBHcmFrbkNsaWVudEVycm9yLCBFcnJvck1lc3NhZ2UsXG59IGZyb20gXCIuLi9kZXBlbmRlbmNpZXNfaW50ZXJuYWxcIjtcbmltcG9ydCBHcmFrblByb3RvIGZyb20gXCJncmFrbmxhYnMtcHJvdG9jb2wvcHJvdG9idWYvZ3Jha25fZ3JwY19wYlwiO1xuaW1wb3J0IEdyYWtuR3JwYyA9IEdyYWtuUHJvdG8uR3Jha25DbGllbnQ7XG5pbXBvcnQgU2Vzc2lvblByb3RvIGZyb20gXCJncmFrbmxhYnMtcHJvdG9jb2wvcHJvdG9idWYvc2Vzc2lvbl9wYlwiO1xuXG5leHBvcnQgY2xhc3MgUlBDU2Vzc2lvbiBpbXBsZW1lbnRzIEdyYWtuLlNlc3Npb24ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2dycGNDbGllbnQ6IEdyYWtuR3JwYztcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9kYXRhYmFzZTogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3R5cGU6IEdyYWtuLlNlc3Npb25UeXBlO1xuICAgIHByaXZhdGUgX3Nlc3Npb25JZDogc3RyaW5nO1xuICAgIHByaXZhdGUgX2lzT3BlbjogYm9vbGVhbjtcbiAgICBwcml2YXRlIF9wdWxzZTogTm9kZUpTLlRpbWVvdXQ7XG5cbiAgICBjb25zdHJ1Y3RvcihncnBjQ2xpZW50OiBHcmFrbkdycGMsIGRhdGFiYXNlOiBzdHJpbmcsIHR5cGU6IEdyYWtuLlNlc3Npb25UeXBlKSB7XG4gICAgICAgIHRoaXMuX2RhdGFiYXNlID0gZGF0YWJhc2U7XG4gICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLl9ncnBjQ2xpZW50ID0gZ3JwY0NsaWVudDtcbiAgICB9XG5cbiAgICBhc3luYyBvcGVuKG9wdGlvbnM6IEdyYWtuT3B0aW9ucyA9IG5ldyBHcmFrbk9wdGlvbnMoKSk6IFByb21pc2U8R3Jha24uU2Vzc2lvbj4ge1xuICAgICAgICBjb25zdCBvcGVuUmVxID0gbmV3IFNlc3Npb25Qcm90by5TZXNzaW9uLk9wZW4uUmVxKClcbiAgICAgICAgICAgIC5zZXREYXRhYmFzZSh0aGlzLl9kYXRhYmFzZSlcbiAgICAgICAgICAgIC5zZXRUeXBlKHNlc3Npb25UeXBlKHRoaXMuX3R5cGUpKVxuICAgICAgICAgICAgLnNldE9wdGlvbnMoUHJvdG9CdWlsZGVyLm9wdGlvbnMob3B0aW9ucykpO1xuICAgICAgICB0aGlzLl9pc09wZW4gPSB0cnVlO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBuZXcgUHJvbWlzZTxTZXNzaW9uUHJvdG8uU2Vzc2lvbi5PcGVuLlJlcz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5fZ3JwY0NsaWVudC5zZXNzaW9uX29wZW4ob3BlblJlcSwgKGVyciwgcmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgZWxzZSByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3Nlc3Npb25JZCA9IHJlcy5nZXRTZXNzaW9uSWRfYXNCNjQoKTtcbiAgICAgICAgdGhpcy5fcHVsc2UgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMucHVsc2UoKSwgNTAwMCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHRyYW5zYWN0aW9uKHR5cGU6IEdyYWtuLlRyYW5zYWN0aW9uVHlwZSwgb3B0aW9uczogR3Jha25PcHRpb25zID0gbmV3IEdyYWtuT3B0aW9ucygpKTogUHJvbWlzZTxHcmFrbi5UcmFuc2FjdGlvbj4ge1xuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IG5ldyBSUENUcmFuc2FjdGlvbih0aGlzLl9ncnBjQ2xpZW50LCB0eXBlKTtcbiAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uLm9wZW4odGhpcy5fc2Vzc2lvbklkLCBvcHRpb25zKTtcbiAgICB9XG5cbiAgICB0eXBlKCk6IEdyYWtuLlNlc3Npb25UeXBlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGU7XG4gICAgfVxuXG4gICAgaXNPcGVuKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNPcGVuO1xuICAgIH1cblxuICAgIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAodGhpcy5faXNPcGVuKSB7XG4gICAgICAgICAgICB0aGlzLl9pc09wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9wdWxzZSk7XG4gICAgICAgICAgICBjb25zdCByZXEgPSBuZXcgU2Vzc2lvblByb3RvLlNlc3Npb24uQ2xvc2UuUmVxKCkuc2V0U2Vzc2lvbklkKHRoaXMuX3Nlc3Npb25JZCk7XG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZ3JwY0NsaWVudC5zZXNzaW9uX2Nsb3NlKHJlcSwgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRhdGFiYXNlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhYmFzZTtcbiAgICB9XG5cbiAgICBwdWxzZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc09wZW4pIHJldHVybjtcbiAgICAgICAgY29uc3QgcHVsc2UgPSBuZXcgU2Vzc2lvblByb3RvLlNlc3Npb24uUHVsc2UuUmVxKCkuc2V0U2Vzc2lvbklkKHRoaXMuX3Nlc3Npb25JZCk7XG4gICAgICAgIHRoaXMuX2dycGNDbGllbnQuc2Vzc2lvbl9wdWxzZShwdWxzZSwgKGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuOy8vIEdlbmVyYWxseSBtZWFucyB0aGUgc2Vzc2lvbiBoYXMgYmVlbiBjbG9zZWQsIHdoaWNoIGlzIGZpbmVcbiAgICAgICAgICAgIGVsc2UgdGhpcy5fcHVsc2UgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMucHVsc2UoKSwgNTAwMCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc2Vzc2lvblR5cGUodHlwZTogR3Jha24uU2Vzc2lvblR5cGUpOiBTZXNzaW9uUHJvdG8uU2Vzc2lvbi5UeXBlIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBHcmFrbi5TZXNzaW9uVHlwZS5EQVRBOlxuICAgICAgICAgICAgcmV0dXJuIFNlc3Npb25Qcm90by5TZXNzaW9uLlR5cGUuREFUQTtcbiAgICAgICAgY2FzZSBHcmFrbi5TZXNzaW9uVHlwZS5TQ0hFTUE6XG4gICAgICAgICAgICByZXR1cm4gU2Vzc2lvblByb3RvLlNlc3Npb24uVHlwZS5TQ0hFTUE7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgR3Jha25DbGllbnRFcnJvcihFcnJvck1lc3NhZ2UuQ2xpZW50LlVOUkVDT0dOSVNFRF9TRVNTSU9OX1RZUEUubWVzc2FnZSgpKVxuICAgIH1cbn1cbiJdfQ==