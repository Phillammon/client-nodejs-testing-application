/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/type/impl/ThingTypeImpl", ["require", "exports", "grakn-client/dependencies_internal", "graknlabs-protocol/protobuf/concept_pb"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.RemoteThingTypeImpl = exports.ThingTypeImpl = void 0;
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    const concept_pb_1 = __importDefault(require("graknlabs-protocol/protobuf/concept_pb"));
    class ThingTypeImpl extends dependencies_internal_1.TypeImpl {
        constructor(label, isRoot) {
            super(label, isRoot);
        }
        asRemote(transaction) {
            return new RemoteThingTypeImpl(transaction, this.getLabel(), this.isRoot());
        }
    }
    exports.ThingTypeImpl = ThingTypeImpl;
    class RemoteThingTypeImpl extends dependencies_internal_1.RemoteTypeImpl {
        constructor(transaction, label, isRoot) {
            super(transaction, label, isRoot);
        }
        setSupertype(thingType) {
            return super.setSupertype(thingType);
        }
        getSupertype() {
            return super.getSupertype();
        }
        getSupertypes() {
            return super.getSupertypes();
        }
        getSubtypes() {
            return super.getSubtypes();
        }
        getInstances() {
            const request = new concept_pb_1.default.Type.Req().setThingTypeGetInstancesReq(new concept_pb_1.default.ThingType.GetInstances.Req());
            return this.thingStream(request, res => res.getThingTypeGetInstancesRes().getThingList());
        }
        setAbstract() {
            return __awaiter(this, void 0, void 0, function* () {
                yield this.execute(new concept_pb_1.default.Type.Req().setThingTypeSetAbstractReq(new concept_pb_1.default.ThingType.SetAbstract.Req()));
            });
        }
        unsetAbstract() {
            return __awaiter(this, void 0, void 0, function* () {
                yield this.execute(new concept_pb_1.default.Type.Req().setThingTypeUnsetAbstractReq(new concept_pb_1.default.ThingType.UnsetAbstract.Req()));
            });
        }
        setPlays(role, overriddenType) {
            return __awaiter(this, void 0, void 0, function* () {
                const setPlaysReq = new concept_pb_1.default.ThingType.SetPlays.Req().setRole(dependencies_internal_1.ConceptProtoBuilder.type(role));
                if (overriddenType)
                    setPlaysReq.setOverriddenRole(dependencies_internal_1.ConceptProtoBuilder.type(overriddenType));
                yield this.execute(new concept_pb_1.default.Type.Req().setThingTypeSetPlaysReq(setPlaysReq));
            });
        }
        setOwns(attributeType, isKeyOrOverriddenType, overriddenType) {
            return __awaiter(this, void 0, void 0, function* () {
                const setOwnsReq = new concept_pb_1.default.ThingType.SetOwns.Req().setAttributeType(dependencies_internal_1.ConceptProtoBuilder.type(attributeType))
                    .setIsKey(typeof isKeyOrOverriddenType === "boolean" ? isKeyOrOverriddenType : false);
                let overriddenType1;
                if (isKeyOrOverriddenType instanceof dependencies_internal_1.AttributeTypeImpl)
                    overriddenType1 = isKeyOrOverriddenType;
                else if (overriddenType)
                    overriddenType1 = overriddenType;
                if (overriddenType1)
                    setOwnsReq.setOverriddenType(dependencies_internal_1.ConceptProtoBuilder.type(overriddenType1));
                yield this.execute(new concept_pb_1.default.Type.Req().setThingTypeSetOwnsReq(setOwnsReq));
            });
        }
        getPlays() {
            const request = new concept_pb_1.default.Type.Req().setThingTypeGetPlaysReq(new concept_pb_1.default.ThingType.GetPlays.Req());
            return this.typeStream(request, res => res.getThingTypeGetPlaysRes().getRoleList());
        }
        getOwns(valueTypeOrKeysOnly, keysOnly) {
            const getOwnsReq = new concept_pb_1.default.ThingType.GetOwns.Req()
                .setKeysOnly(typeof valueTypeOrKeysOnly === "boolean" ? valueTypeOrKeysOnly : typeof keysOnly === "boolean" ? keysOnly : false);
            // Here we take advantage of the fact that AttributeType.ValueType is a string enum
            if (typeof valueTypeOrKeysOnly === "string")
                getOwnsReq.setValueType(dependencies_internal_1.ConceptProtoBuilder.valueType(valueTypeOrKeysOnly));
            const request = new concept_pb_1.default.Type.Req().setThingTypeGetOwnsReq(getOwnsReq);
            return this.typeStream(request, res => res.getThingTypeGetOwnsRes().getAttributeTypeList());
        }
        unsetPlays(role) {
            return __awaiter(this, void 0, void 0, function* () {
                yield this.execute(new concept_pb_1.default.Type.Req().setThingTypeUnsetPlaysReq(new concept_pb_1.default.ThingType.UnsetPlays.Req().setRole(dependencies_internal_1.ConceptProtoBuilder.type(role))));
            });
        }
        unsetOwns(attributeType) {
            return __awaiter(this, void 0, void 0, function* () {
                yield this.execute(new concept_pb_1.default.Type.Req().setThingTypeUnsetOwnsReq(new concept_pb_1.default.ThingType.UnsetOwns.Req().setAttributeType(dependencies_internal_1.ConceptProtoBuilder.type(attributeType))));
            });
        }
        asRemote(transaction) {
            return new RemoteThingTypeImpl(transaction, this.getLabel(), this.isRoot());
        }
    }
    exports.RemoteThingTypeImpl = RemoteThingTypeImpl;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGhpbmdUeXBlSW1wbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2NvbmNlcHQvdHlwZS9pbXBsL1RoaW5nVHlwZUltcGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBRUgsOEVBYXdDO0lBRXhDLHdGQUFrRTtJQUdsRSxNQUFhLGFBQWMsU0FBUSxnQ0FBUTtRQUN2QyxZQUFZLEtBQWEsRUFBRSxNQUFlO1lBQ3RDLEtBQUssQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDekIsQ0FBQztRQUVELFFBQVEsQ0FBQyxXQUF3QjtZQUM3QixPQUFPLElBQUksbUJBQW1CLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUNoRixDQUFDO0tBQ0o7SUFSRCxzQ0FRQztJQUVELE1BQWEsbUJBQW9CLFNBQVEsc0NBQWM7UUFDbkQsWUFBWSxXQUF3QixFQUFFLEtBQWEsRUFBRSxNQUFlO1lBQ2hFLEtBQUssQ0FBQyxXQUFXLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3RDLENBQUM7UUFFUyxZQUFZLENBQUMsU0FBb0I7WUFDdkMsT0FBTyxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFFRCxZQUFZO1lBQ1IsT0FBTyxLQUFLLENBQUMsWUFBWSxFQUE0QixDQUFDO1FBQzFELENBQUM7UUFFRCxhQUFhO1lBQ1QsT0FBTyxLQUFLLENBQUMsYUFBYSxFQUEyQixDQUFDO1FBQzFELENBQUM7UUFFRCxXQUFXO1lBQ1AsT0FBTyxLQUFLLENBQUMsV0FBVyxFQUEyQixDQUFDO1FBQ3hELENBQUM7UUFFRCxZQUFZO1lBQ1IsTUFBTSxPQUFPLEdBQUcsSUFBSSxvQkFBWSxDQUFDLElBQUksQ0FBQyxH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QUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLGdCQUFnQixDQUFDLDJDQUFtQixDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvRyxDQUFDO1NBQUE7UUFFRCxRQUFRLENBQUMsV0FBd0I7WUFDN0IsT0FBTyxJQUFJLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDaEYsQ0FBQztLQUNKO0lBdkZELGtEQXVGQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIFR5cGVJbXBsLFxuICAgIFJlbW90ZVR5cGVJbXBsLFxuICAgIFRoaW5nVHlwZSxcbiAgICBSZW1vdGVUaGluZ1R5cGUsXG4gICAgQXR0cmlidXRlVHlwZSxcbiAgICBSb2xlVHlwZSxcbiAgICBHcmFrbixcbiAgICBTdHJlYW0sXG4gICAgVGhpbmdJbXBsLFxuICAgIFJvbGVUeXBlSW1wbCxcbiAgICBBdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBDb25jZXB0UHJvdG9CdWlsZGVyLFxufSBmcm9tIFwiLi4vLi4vLi4vZGVwZW5kZW5jaWVzX2ludGVybmFsXCI7XG5pbXBvcnQgVHJhbnNhY3Rpb24gPSBHcmFrbi5UcmFuc2FjdGlvbjtcbmltcG9ydCBDb25jZXB0UHJvdG8gZnJvbSBcImdyYWtubGFicy1wcm90b2NvbC9wcm90b2J1Zi9jb25jZXB0X3BiXCI7XG5cblxuZXhwb3J0IGNsYXNzIFRoaW5nVHlwZUltcGwgZXh0ZW5kcyBUeXBlSW1wbCBpbXBsZW1lbnRzIFRoaW5nVHlwZSB7XG4gICAgY29uc3RydWN0b3IobGFiZWw6IHN0cmluZywgaXNSb290OiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKGxhYmVsLCBpc1Jvb3QpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZVRoaW5nVHlwZSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVtb3RlVGhpbmdUeXBlSW1wbCh0cmFuc2FjdGlvbiwgdGhpcy5nZXRMYWJlbCgpLCB0aGlzLmlzUm9vdCgpKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSZW1vdGVUaGluZ1R5cGVJbXBsIGV4dGVuZHMgUmVtb3RlVHlwZUltcGwgaW1wbGVtZW50cyBSZW1vdGVUaGluZ1R5cGUge1xuICAgIGNvbnN0cnVjdG9yKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbiwgbGFiZWw6IHN0cmluZywgaXNSb290OiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKHRyYW5zYWN0aW9uLCBsYWJlbCwgaXNSb290KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2V0U3VwZXJ0eXBlKHRoaW5nVHlwZTogVGhpbmdUeXBlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiBzdXBlci5zZXRTdXBlcnR5cGUodGhpbmdUeXBlKTtcbiAgICB9XG5cbiAgICBnZXRTdXBlcnR5cGUoKTogUHJvbWlzZTxUaGluZ1R5cGVJbXBsPiB7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXRTdXBlcnR5cGUoKSBhcyBQcm9taXNlPFRoaW5nVHlwZUltcGw+O1xuICAgIH1cblxuICAgIGdldFN1cGVydHlwZXMoKTogU3RyZWFtPFRoaW5nVHlwZUltcGw+IHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmdldFN1cGVydHlwZXMoKSBhcyBTdHJlYW08VGhpbmdUeXBlSW1wbD47XG4gICAgfVxuXG4gICAgZ2V0U3VidHlwZXMoKTogU3RyZWFtPFRoaW5nVHlwZUltcGw+IHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmdldFN1YnR5cGVzKCkgYXMgU3RyZWFtPFRoaW5nVHlwZUltcGw+O1xuICAgIH1cblxuICAgIGdldEluc3RhbmNlcygpOiBTdHJlYW08VGhpbmdJbXBsPiB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgQ29uY2VwdFByb3RvLlR5cGUuUmVxKCkuc2V0VGhpbmdUeXBlR2V0SW5zdGFuY2VzUmVxKG5ldyBDb25jZXB0UHJvdG8uVGhpbmdUeXBlLkdldEluc3RhbmNlcy5SZXEoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRoaW5nU3RyZWFtKHJlcXVlc3QsIHJlcyA9PiByZXMuZ2V0VGhpbmdUeXBlR2V0SW5zdGFuY2VzUmVzKCkuZ2V0VGhpbmdMaXN0KCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHNldEFic3RyYWN0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGUobmV3IENvbmNlcHRQcm90by5UeXBlLlJlcSgpLnNldFRoaW5nVHlwZVNldEFic3RyYWN0UmVxKG5ldyBDb25jZXB0UHJvdG8uVGhpbmdUeXBlLlNldEFic3RyYWN0LlJlcSgpKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgdW5zZXRBYnN0cmFjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlKG5ldyBDb25jZXB0UHJvdG8uVHlwZS5SZXEoKS5zZXRUaGluZ1R5cGVVbnNldEFic3RyYWN0UmVxKG5ldyBDb25jZXB0UHJvdG8uVGhpbmdUeXBlLlVuc2V0QWJzdHJhY3QuUmVxKCkpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXRQbGF5cyhyb2xlOiBSb2xlVHlwZSk6IFByb21pc2U8dm9pZD47XG4gICAgYXN5bmMgc2V0UGxheXMocm9sZTogUm9sZVR5cGUsIG92ZXJyaWRkZW5UeXBlOiBSb2xlVHlwZSk6IFByb21pc2U8dm9pZD47XG4gICAgYXN5bmMgc2V0UGxheXMocm9sZTogUm9sZVR5cGUsIG92ZXJyaWRkZW5UeXBlPzogUm9sZVR5cGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3Qgc2V0UGxheXNSZXEgPSBuZXcgQ29uY2VwdFByb3RvLlRoaW5nVHlwZS5TZXRQbGF5cy5SZXEoKS5zZXRSb2xlKENvbmNlcHRQcm90b0J1aWxkZXIudHlwZShyb2xlKSk7XG4gICAgICAgIGlmIChvdmVycmlkZGVuVHlwZSkgc2V0UGxheXNSZXEuc2V0T3ZlcnJpZGRlblJvbGUoQ29uY2VwdFByb3RvQnVpbGRlci50eXBlKG92ZXJyaWRkZW5UeXBlKSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZShuZXcgQ29uY2VwdFByb3RvLlR5cGUuUmVxKCkuc2V0VGhpbmdUeXBlU2V0UGxheXNSZXEoc2V0UGxheXNSZXEpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXRPd25zKGF0dHJpYnV0ZVR5cGU6IEF0dHJpYnV0ZVR5cGUpOiBQcm9taXNlPHZvaWQ+O1xuICAgIGFzeW5jIHNldE93bnMoYXR0cmlidXRlVHlwZTogQXR0cmlidXRlVHlwZSwgaXNLZXk6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+O1xuICAgIGFzeW5jIHNldE93bnMoYXR0cmlidXRlVHlwZTogQXR0cmlidXRlVHlwZSwgb3ZlcnJpZGRlblR5cGU6IEF0dHJpYnV0ZVR5cGUpOiBQcm9taXNlPHZvaWQ+O1xuICAgIGFzeW5jIHNldE93bnMoYXR0cmlidXRlVHlwZTogQXR0cmlidXRlVHlwZSwgaXNLZXk6IGJvb2xlYW4sIG92ZXJyaWRkZW5UeXBlOiBBdHRyaWJ1dGVUeXBlKTogUHJvbWlzZTx2b2lkPjtcbiAgICBhc3luYyBzZXRPd25zKGF0dHJpYnV0ZVR5cGU6IEF0dHJpYnV0ZVR5cGUsIGlzS2V5T3JPdmVycmlkZGVuVHlwZT86IGJvb2xlYW4gfCBBdHRyaWJ1dGVUeXBlLCBvdmVycmlkZGVuVHlwZT86IEF0dHJpYnV0ZVR5cGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3Qgc2V0T3duc1JlcSA9IG5ldyBDb25jZXB0UHJvdG8uVGhpbmdUeXBlLlNldE93bnMuUmVxKCkuc2V0QXR0cmlidXRlVHlwZShDb25jZXB0UHJvdG9CdWlsZGVyLnR5cGUoYXR0cmlidXRlVHlwZSkpXG4gICAgICAgICAgICAuc2V0SXNLZXkodHlwZW9mIGlzS2V5T3JPdmVycmlkZGVuVHlwZSA9PT0gXCJib29sZWFuXCIgPyBpc0tleU9yT3ZlcnJpZGRlblR5cGUgOiBmYWxzZSk7XG4gICAgICAgIGxldCBvdmVycmlkZGVuVHlwZTE6IEF0dHJpYnV0ZVR5cGU7XG4gICAgICAgIGlmIChpc0tleU9yT3ZlcnJpZGRlblR5cGUgaW5zdGFuY2VvZiBBdHRyaWJ1dGVUeXBlSW1wbCkgb3ZlcnJpZGRlblR5cGUxID0gaXNLZXlPck92ZXJyaWRkZW5UeXBlO1xuICAgICAgICBlbHNlIGlmIChvdmVycmlkZGVuVHlwZSkgb3ZlcnJpZGRlblR5cGUxID0gb3ZlcnJpZGRlblR5cGU7XG4gICAgICAgIGlmIChvdmVycmlkZGVuVHlwZTEpIHNldE93bnNSZXEuc2V0T3ZlcnJpZGRlblR5cGUoQ29uY2VwdFByb3RvQnVpbGRlci50eXBlKG92ZXJyaWRkZW5UeXBlMSkpO1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGUobmV3IENvbmNlcHRQcm90by5UeXBlLlJlcSgpLnNldFRoaW5nVHlwZVNldE93bnNSZXEoc2V0T3duc1JlcSkpO1xuICAgIH1cblxuICAgIGdldFBsYXlzKCk6IFN0cmVhbTxSb2xlVHlwZUltcGw+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IG5ldyBDb25jZXB0UHJvdG8uVHlwZS5SZXEoKS5zZXRUaGluZ1R5cGVHZXRQbGF5c1JlcShuZXcgQ29uY2VwdFByb3RvLlRoaW5nVHlwZS5HZXRQbGF5cy5SZXEoKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnR5cGVTdHJlYW0ocmVxdWVzdCwgcmVzID0+IHJlcy5nZXRUaGluZ1R5cGVHZXRQbGF5c1JlcygpLmdldFJvbGVMaXN0KCkpIGFzIFN0cmVhbTxSb2xlVHlwZUltcGw+O1xuICAgIH1cblxuICAgIGdldE93bnMoKTogU3RyZWFtPEF0dHJpYnV0ZVR5cGVJbXBsPjtcbiAgICBnZXRPd25zKHZhbHVlVHlwZTogQXR0cmlidXRlVHlwZS5WYWx1ZVR5cGUpOiBTdHJlYW08QXR0cmlidXRlVHlwZUltcGw+O1xuICAgIGdldE93bnMoa2V5c09ubHk6IGJvb2xlYW4pOiBTdHJlYW08QXR0cmlidXRlVHlwZUltcGw+O1xuICAgIGdldE93bnModmFsdWVUeXBlOiBBdHRyaWJ1dGVUeXBlLlZhbHVlVHlwZSwga2V5c09ubHk6IGJvb2xlYW4pOiBTdHJlYW08QXR0cmlidXRlVHlwZUltcGw+O1xuICAgIGdldE93bnModmFsdWVUeXBlT3JLZXlzT25seT86IEF0dHJpYnV0ZVR5cGUuVmFsdWVUeXBlIHwgYm9vbGVhbiwga2V5c09ubHk/OiBib29sZWFuKTogU3RyZWFtPEF0dHJpYnV0ZVR5cGVJbXBsPiB7XG4gICAgICAgIGNvbnN0IGdldE93bnNSZXEgPSBuZXcgQ29uY2VwdFByb3RvLlRoaW5nVHlwZS5HZXRPd25zLlJlcSgpXG4gICAgICAgICAgICAuc2V0S2V5c09ubHkodHlwZW9mIHZhbHVlVHlwZU9yS2V5c09ubHkgPT09IFwiYm9vbGVhblwiID8gdmFsdWVUeXBlT3JLZXlzT25seSA6IHR5cGVvZiBrZXlzT25seSA9PT0gXCJib29sZWFuXCIgPyBrZXlzT25seSA6IGZhbHNlKTtcbiAgICAgICAgLy8gSGVyZSB3ZSB0YWtlIGFkdmFudGFnZSBvZiB0aGUgZmFjdCB0aGF0IEF0dHJpYnV0ZVR5cGUuVmFsdWVUeXBlIGlzIGEgc3RyaW5nIGVudW1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZVR5cGVPcktleXNPbmx5ID09PSBcInN0cmluZ1wiKSBnZXRPd25zUmVxLnNldFZhbHVlVHlwZShDb25jZXB0UHJvdG9CdWlsZGVyLnZhbHVlVHlwZSh2YWx1ZVR5cGVPcktleXNPbmx5KSk7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgQ29uY2VwdFByb3RvLlR5cGUuUmVxKCkuc2V0VGhpbmdUeXBlR2V0T3duc1JlcShnZXRPd25zUmVxKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZVN0cmVhbShyZXF1ZXN0LCByZXMgPT4gcmVzLmdldFRoaW5nVHlwZUdldE93bnNSZXMoKS5nZXRBdHRyaWJ1dGVUeXBlTGlzdCgpKSBhcyBTdHJlYW08QXR0cmlidXRlVHlwZUltcGw+O1xuICAgIH1cblxuICAgIGFzeW5jIHVuc2V0UGxheXMocm9sZTogUm9sZVR5cGUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlKG5ldyBDb25jZXB0UHJvdG8uVHlwZS5SZXEoKS5zZXRUaGluZ1R5cGVVbnNldFBsYXlzUmVxKFxuICAgICAgICAgICAgbmV3IENvbmNlcHRQcm90by5UaGluZ1R5cGUuVW5zZXRQbGF5cy5SZXEoKS5zZXRSb2xlKENvbmNlcHRQcm90b0J1aWxkZXIudHlwZShyb2xlKSkpKTtcbiAgICB9XG5cbiAgICBhc3luYyB1bnNldE93bnMoYXR0cmlidXRlVHlwZTogQXR0cmlidXRlVHlwZSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGUobmV3IENvbmNlcHRQcm90by5UeXBlLlJlcSgpLnNldFRoaW5nVHlwZVVuc2V0T3duc1JlcShcbiAgICAgICAgICAgIG5ldyBDb25jZXB0UHJvdG8uVGhpbmdUeXBlLlVuc2V0T3ducy5SZXEoKS5zZXRBdHRyaWJ1dGVUeXBlKENvbmNlcHRQcm90b0J1aWxkZXIudHlwZShhdHRyaWJ1dGVUeXBlKSkpKTtcbiAgICB9XG5cbiAgICBhc1JlbW90ZSh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pOiBSZW1vdGVUaGluZ1R5cGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVUaGluZ1R5cGVJbXBsKHRyYW5zYWN0aW9uLCB0aGlzLmdldExhYmVsKCksIHRoaXMuaXNSb290KCkpO1xuICAgIH1cbn1cbiJdfQ==