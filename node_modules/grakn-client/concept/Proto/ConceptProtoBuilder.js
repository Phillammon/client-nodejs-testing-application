/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/proto/ConceptProtoBuilder", ["require", "exports", "graknlabs-grpc-protocol/protobuf/concept_pb", "grakn-client/dependencies_internal"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ConceptProtoBuilder = void 0;
    // TODO: Can we get rid of this?
    const concept_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/concept_pb"));
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    var ConceptProtoBuilder;
    (function (ConceptProtoBuilder) {
        function thing(thing) {
            return new concept_pb_1.default.Thing()
                .setIid(thing.getIID())
                .setEncoding(thingEncoding(thing));
        }
        ConceptProtoBuilder.thing = thing;
        function type(type) {
            const typeProto = new concept_pb_1.default.Type()
                .setLabel(type.getLabel())
                .setEncoding(typeEncoding(type));
            if (type instanceof dependencies_internal_1.RoleTypeImpl) {
                typeProto.setScope(type.getScope());
            }
            return typeProto;
        }
        ConceptProtoBuilder.type = type;
        function types(types) {
            return types.map(type);
        }
        ConceptProtoBuilder.types = types;
        // The 'attributeValue' functions are split up like this to avoid ambiguity between Long and Double
        function booleanAttributeValue(value) {
            return new concept_pb_1.default.Attribute.Value().setBoolean(value);
        }
        ConceptProtoBuilder.booleanAttributeValue = booleanAttributeValue;
        function longAttributeValue(value) {
            return new concept_pb_1.default.Attribute.Value().setLong(value);
        }
        ConceptProtoBuilder.longAttributeValue = longAttributeValue;
        function doubleAttributeValue(value) {
            return new concept_pb_1.default.Attribute.Value().setDouble(value);
        }
        ConceptProtoBuilder.doubleAttributeValue = doubleAttributeValue;
        function stringAttributeValue(value) {
            return new concept_pb_1.default.Attribute.Value().setString(value);
        }
        ConceptProtoBuilder.stringAttributeValue = stringAttributeValue;
        function dateTimeAttributeValue(value) {
            return new concept_pb_1.default.Attribute.Value().setDateTime(value.getTime());
        }
        ConceptProtoBuilder.dateTimeAttributeValue = dateTimeAttributeValue;
        function valueType(valueType) {
            switch (valueType) {
                case dependencies_internal_1.AttributeType.ValueType.OBJECT:
                    return concept_pb_1.default.AttributeType.VALUE_TYPE.OBJECT;
                case dependencies_internal_1.AttributeType.ValueType.BOOLEAN:
                    return concept_pb_1.default.AttributeType.VALUE_TYPE.BOOLEAN;
                case dependencies_internal_1.AttributeType.ValueType.LONG:
                    return concept_pb_1.default.AttributeType.VALUE_TYPE.LONG;
                case dependencies_internal_1.AttributeType.ValueType.DOUBLE:
                    return concept_pb_1.default.AttributeType.VALUE_TYPE.DOUBLE;
                case dependencies_internal_1.AttributeType.ValueType.STRING:
                    return concept_pb_1.default.AttributeType.VALUE_TYPE.STRING;
                case dependencies_internal_1.AttributeType.ValueType.DATETIME:
                    return concept_pb_1.default.AttributeType.VALUE_TYPE.DATETIME;
                default:
                    throw "Value type not recognised";
            }
        }
        ConceptProtoBuilder.valueType = valueType;
        function thingEncoding(thing) {
            if (thing instanceof dependencies_internal_1.EntityImpl) {
                return concept_pb_1.default.Thing.ENCODING.ENTITY;
            }
            else if (thing instanceof dependencies_internal_1.RelationImpl) {
                return concept_pb_1.default.Thing.ENCODING.RELATION;
            }
            else if (thing instanceof dependencies_internal_1.AttributeImpl) {
                return concept_pb_1.default.Thing.ENCODING.ATTRIBUTE;
            }
            else {
                throw "Unrecognised Thing class";
            }
        }
        ConceptProtoBuilder.thingEncoding = thingEncoding;
        function typeEncoding(type) {
            if (type instanceof dependencies_internal_1.EntityTypeImpl) {
                return concept_pb_1.default.Type.ENCODING.ENTITY_TYPE;
            }
            else if (type instanceof dependencies_internal_1.RelationTypeImpl) {
                return concept_pb_1.default.Type.ENCODING.RELATION_TYPE;
            }
            else if (type instanceof dependencies_internal_1.AttributeTypeImpl) {
                return concept_pb_1.default.Type.ENCODING.ATTRIBUTE_TYPE;
            }
            else if (type instanceof dependencies_internal_1.RoleTypeImpl) {
                return concept_pb_1.default.Type.ENCODING.ROLE_TYPE;
            }
            else if (type instanceof dependencies_internal_1.ThingTypeImpl) {
                return concept_pb_1.default.Type.ENCODING.THING_TYPE;
            }
            else {
                throw "Unrecognised Type class";
            }
        }
        ConceptProtoBuilder.typeEncoding = typeEncoding;
    })(ConceptProtoBuilder = exports.ConceptProtoBuilder || (exports.ConceptProtoBuilder = {}));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uY2VwdFByb3RvQnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2NvbmNlcHQvcHJvdG8vQ29uY2VwdFByb3RvQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FpQkc7Ozs7Ozs7Ozs7Ozs7Ozs7SUFFSCxnQ0FBZ0M7SUFFaEMsNkZBQXVFO0lBQ3ZFLDhFQVlxQztJQUVyQyxJQUFpQixtQkFBbUIsQ0EyRm5DO0lBM0ZELFdBQWlCLG1CQUFtQjtRQUVoQyxTQUFnQixLQUFLLENBQUMsS0FBWTtZQUM5QixPQUFPLElBQUksb0JBQVksQ0FBQyxLQUFLLEVBQUU7aUJBQzFCLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7aUJBQ3RCLFdBQVcsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMzQyxDQUFDO1FBSmUseUJBQUssUUFJcEIsQ0FBQTtRQUVELFNBQWdCLElBQUksQ0FBQyxJQUFVO1lBQzNCLE1BQU0sU0FBUyxHQUFHLElBQUksb0JBQVksQ0FBQyxJQUFJLEVBQUU7aUJBQ3BDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7aUJBQ3pCLFdBQVcsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUVyQyxJQUFJLElBQUksWUFBWSxvQ0FBWSxFQUFFO2dCQUM5QixTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO2FBQ3ZDO1lBRUQsT0FBTyxTQUFTLENBQUM7UUFDckIsQ0FBQztRQVZlLHdCQUFJLE9BVW5CLENBQUE7UUFFRCxTQUFnQixLQUFLLENBQUMsS0FBYTtZQUMvQixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsQ0FBQztRQUZlLHlCQUFLLFFBRXBCLENBQUE7UUFFRCxtR0FBbUc7UUFDbkcsU0FBZ0Is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QUFPLG9CQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUM7YUFDakQ7aUJBQU0sSUFBSSxJQUFJLFlBQVksd0NBQWdCLEVBQUU7Z0JBQ3pDLE9BQU8sb0JBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQzthQUNuRDtpQkFBTSxJQUFJLElBQUksWUFBWSx5Q0FBaUIsRUFBRTtnQkFDMUMsT0FBTyxvQkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDO2FBQ3BEO2lCQUFNLElBQUksSUFBSSxZQUFZLG9DQUFZLEVBQUU7Z0JBQ3JDLE9BQU8sb0JBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQzthQUMvQztpQkFBTSxJQUFJLElBQUksWUFBWSxxQ0FBYSxFQUFFO2dCQUN0QyxPQUFPLG9CQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7YUFDaEQ7aUJBQU07Z0JBQ0gsTUFBTSx5QkFBeUIsQ0FBQzthQUNuQztRQUNMLENBQUM7UUFkZSxnQ0FBWSxlQWMzQixDQUFBO0lBQ0wsQ0FBQyxFQTNGZ0IsbUJBQW1CLEdBQW5CLDJCQUFtQixLQUFuQiwyQkFBbUIsUUEyRm5DIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8vIFRPRE86IENhbiB3ZSBnZXQgcmlkIG9mIHRoaXM/XG5cbmltcG9ydCBDb25jZXB0UHJvdG8gZnJvbSBcImdyYWtubGFicy1ncnBjLXByb3RvY29sL3Byb3RvYnVmL2NvbmNlcHRfcGJcIjtcbmltcG9ydCB7XG4gICAgVHlwZSxcbiAgICBUaGluZyxcbiAgICBBdHRyaWJ1dGVUeXBlLFxuICAgIFJvbGVUeXBlSW1wbCxcbiAgICBFbnRpdHlJbXBsICxcbiAgICBSZWxhdGlvbkltcGwsXG4gICAgQXR0cmlidXRlSW1wbCxcbiAgICBFbnRpdHlUeXBlSW1wbCAsXG4gICAgUmVsYXRpb25UeXBlSW1wbCAsXG4gICAgQXR0cmlidXRlVHlwZUltcGwgLFxuICAgIFRoaW5nVHlwZUltcGwsXG59IGZyb20gXCIuLi8uLi9kZXBlbmRlbmNpZXNfaW50ZXJuYWxcIjtcblxuZXhwb3J0IG5hbWVzcGFjZSBDb25jZXB0UHJvdG9CdWlsZGVyIHtcblxuICAgIGV4cG9ydCBmdW5jdGlvbiB0aGluZyh0aGluZzogVGhpbmcpOiBDb25jZXB0UHJvdG8uVGhpbmcge1xuICAgICAgICByZXR1cm4gbmV3IENvbmNlcHRQcm90by5UaGluZygpXG4gICAgICAgICAgICAuc2V0SWlkKHRoaW5nLmdldElJRCgpKVxuICAgICAgICAgICAgLnNldEVuY29kaW5nKHRoaW5nRW5jb2RpbmcodGhpbmcpKTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gdHlwZSh0eXBlOiBUeXBlKTogQ29uY2VwdFByb3RvLlR5cGUge1xuICAgICAgICBjb25zdCB0eXBlUHJvdG8gPSBuZXcgQ29uY2VwdFByb3RvLlR5cGUoKVxuICAgICAgICAgICAgLnNldExhYmVsKHR5cGUuZ2V0TGFiZWwoKSlcbiAgICAgICAgICAgIC5zZXRFbmNvZGluZyh0eXBlRW5jb2RpbmcodHlwZSkpO1xuXG4gICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgUm9sZVR5cGVJbXBsKSB7XG4gICAgICAgICAgICB0eXBlUHJvdG8uc2V0U2NvcGUodHlwZS5nZXRTY29wZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0eXBlUHJvdG87XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHR5cGVzKHR5cGVzOiBUeXBlW10pOiBDb25jZXB0UHJvdG8uVHlwZVtdIHtcbiAgICAgICAgcmV0dXJuIHR5cGVzLm1hcCh0eXBlKTtcbiAgICB9XG5cbiAgICAvLyBUaGUgJ2F0dHJpYnV0ZVZhbHVlJyBmdW5jdGlvbnMgYXJlIHNwbGl0IHVwIGxpa2UgdGhpcyB0byBhdm9pZCBhbWJpZ3VpdHkgYmV0d2VlbiBMb25nIGFuZCBEb3VibGVcbiAgICBleHBvcnQgZnVuY3Rpb24gYm9vbGVhbkF0dHJpYnV0ZVZhbHVlKHZhbHVlOiBib29sZWFuKTogQ29uY2VwdFByb3RvLkF0dHJpYnV0ZS5WYWx1ZSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZS5WYWx1ZSgpLnNldEJvb2xlYW4odmFsdWUpO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBsb25nQXR0cmlidXRlVmFsdWUodmFsdWU6IG51bWJlcik6IENvbmNlcHRQcm90by5BdHRyaWJ1dGUuVmFsdWUge1xuICAgICAgICByZXR1cm4gbmV3IENvbmNlcHRQcm90by5BdHRyaWJ1dGUuVmFsdWUoKS5zZXRMb25nKHZhbHVlKTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gZG91YmxlQXR0cmlidXRlVmFsdWUodmFsdWU6IG51bWJlcik6IENvbmNlcHRQcm90by5BdHRyaWJ1dGUuVmFsdWUge1xuICAgICAgICByZXR1cm4gbmV3IENvbmNlcHRQcm90by5BdHRyaWJ1dGUuVmFsdWUoKS5zZXREb3VibGUodmFsdWUpO1xuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiBzdHJpbmdBdHRyaWJ1dGVWYWx1ZSh2YWx1ZTogc3RyaW5nKTogQ29uY2VwdFByb3RvLkF0dHJpYnV0ZS5WYWx1ZSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZS5WYWx1ZSgpLnNldFN0cmluZyh2YWx1ZSk7XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGRhdGVUaW1lQXR0cmlidXRlVmFsdWUodmFsdWU6IERhdGUpOiBDb25jZXB0UHJvdG8uQXR0cmlidXRlLlZhbHVlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBDb25jZXB0UHJvdG8uQXR0cmlidXRlLlZhbHVlKCkuc2V0RGF0ZVRpbWUodmFsdWUuZ2V0VGltZSgpKTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gdmFsdWVUeXBlKHZhbHVlVHlwZTogQXR0cmlidXRlVHlwZS5WYWx1ZVR5cGUpOiBDb25jZXB0UHJvdG8uQXR0cmlidXRlVHlwZS5WQUxVRV9UWVBFIHtcbiAgICAgICAgc3dpdGNoICh2YWx1ZVR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgQXR0cmlidXRlVHlwZS5WYWx1ZVR5cGUuT0JKRUNUOlxuICAgICAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uQXR0cmlidXRlVHlwZS5WQUxVRV9UWVBFLk9CSkVDVDtcbiAgICAgICAgICAgIGNhc2UgQXR0cmlidXRlVHlwZS5WYWx1ZVR5cGUuQk9PTEVBTjpcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5CT09MRUFOO1xuICAgICAgICAgICAgY2FzZSBBdHRyaWJ1dGVUeXBlLlZhbHVlVHlwZS5MT05HOlxuICAgICAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uQXR0cmlidXRlVHlwZS5WQUxVRV9UWVBFLkxPTkc7XG4gICAgICAgICAgICBjYXNlIEF0dHJpYnV0ZVR5cGUuVmFsdWVUeXBlLkRPVUJMRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5ET1VCTEU7XG4gICAgICAgICAgICBjYXNlIEF0dHJpYnV0ZVR5cGUuVmFsdWVUeXBlLlNUUklORzpcbiAgICAgICAgICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5TVFJJTkc7XG4gICAgICAgICAgICBjYXNlIEF0dHJpYnV0ZVR5cGUuVmFsdWVUeXBlLkRBVEVUSU1FOlxuICAgICAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uQXR0cmlidXRlVHlwZS5WQUxVRV9UWVBFLkRBVEVUSU1FO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBcIlZhbHVlIHR5cGUgbm90IHJlY29nbmlzZWRcIjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGV4cG9ydCBmdW5jdGlvbiB0aGluZ0VuY29kaW5nKHRoaW5nOiBUaGluZyk6IENvbmNlcHRQcm90by5UaGluZy5FTkNPRElORyB7XG4gICAgICAgIGlmICh0aGluZyBpbnN0YW5jZW9mIEVudGl0eUltcGwpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uVGhpbmcuRU5DT0RJTkcuRU5USVRZO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaW5nIGluc3RhbmNlb2YgUmVsYXRpb25JbXBsKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvLlRoaW5nLkVOQ09ESU5HLlJFTEFUSU9OO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaW5nIGluc3RhbmNlb2YgQXR0cmlidXRlSW1wbCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90by5UaGluZy5FTkNPRElORy5BVFRSSUJVVEU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBcIlVucmVjb2duaXNlZCBUaGluZyBjbGFzc1wiO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHR5cGVFbmNvZGluZyh0eXBlOiBUeXBlKTogQ29uY2VwdFByb3RvLlR5cGUuRU5DT0RJTkcge1xuICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIEVudGl0eVR5cGVJbXBsKSB7XG4gICAgICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvLlR5cGUuRU5DT0RJTkcuRU5USVRZX1RZUEU7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSBpbnN0YW5jZW9mIFJlbGF0aW9uVHlwZUltcGwpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5SRUxBVElPTl9UWVBFO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgaW5zdGFuY2VvZiBBdHRyaWJ1dGVUeXBlSW1wbCkge1xuICAgICAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90by5UeXBlLkVOQ09ESU5HLkFUVFJJQlVURV9UWVBFO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgaW5zdGFuY2VvZiBSb2xlVHlwZUltcGwpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5ST0xFX1RZUEU7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSBpbnN0YW5jZW9mIFRoaW5nVHlwZUltcGwpIHtcbiAgICAgICAgICAgIHJldHVybiBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5USElOR19UWVBFO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgXCJVbnJlY29nbmlzZWQgVHlwZSBjbGFzc1wiO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19