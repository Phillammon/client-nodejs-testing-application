/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/proto/ConceptProtoReader", ["require", "exports", "graknlabs-protocol/protobuf/concept_pb", "assert", "grakn-client/dependencies_internal"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ConceptProtoReader = void 0;
    // TODO: Can we get rid of this?
    const concept_pb_1 = __importDefault(require("graknlabs-protocol/protobuf/concept_pb"));
    const assert_1 = __importDefault(require("assert"));
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    var ConceptProtoReader;
    (function (ConceptProtoReader) {
        // This method cannot live in ThingImpl itself, because doing so creates a circular class reference
        // [ThingImpl -> EntityImpl -> ThingImpl] which causes a JavaScript runtime error
        function thing(thingProto) {
            switch (thingProto.getEncoding()) {
                case concept_pb_1.default.Thing.ENCODING.ENTITY:
                    return dependencies_internal_1.EntityImpl.of(thingProto);
                case concept_pb_1.default.Thing.ENCODING.RELATION:
                    return dependencies_internal_1.RelationImpl.of(thingProto);
                case concept_pb_1.default.Thing.ENCODING.ATTRIBUTE:
                    return attribute(thingProto);
                default:
                    throw new dependencies_internal_1.GraknClientError(dependencies_internal_1.ErrorMessage.Concept.BAD_ENCODING.message(thingProto.getEncoding()));
            }
        }
        ConceptProtoReader.thing = thing;
        function attribute(thingProto) {
            switch (thingProto.getValueType()) {
                case concept_pb_1.default.AttributeType.VALUE_TYPE.BOOLEAN:
                    return dependencies_internal_1.BooleanAttributeImpl.of(thingProto);
                case concept_pb_1.default.AttributeType.VALUE_TYPE.LONG:
                    return dependencies_internal_1.LongAttributeImpl.of(thingProto);
                case concept_pb_1.default.AttributeType.VALUE_TYPE.DOUBLE:
                    return dependencies_internal_1.DoubleAttributeImpl.of(thingProto);
                case concept_pb_1.default.AttributeType.VALUE_TYPE.STRING:
                    return dependencies_internal_1.StringAttributeImpl.of(thingProto);
                case concept_pb_1.default.AttributeType.VALUE_TYPE.DATETIME:
                    return dependencies_internal_1.DateTimeAttributeImpl.of(thingProto);
                default:
                    throw new dependencies_internal_1.GraknClientError(dependencies_internal_1.ErrorMessage.Concept.BAD_VALUE_TYPE.message(thingProto.getValueType()));
            }
        }
        ConceptProtoReader.attribute = attribute;
        function type(typeProto) {
            switch (typeProto.getEncoding()) {
                case concept_pb_1.default.Type.ENCODING.ROLE_TYPE:
                    return dependencies_internal_1.RoleTypeImpl.of(typeProto);
                default:
                    return thingType(typeProto);
            }
        }
        ConceptProtoReader.type = type;
        function thingType(typeProto) {
            switch (typeProto.getEncoding()) {
                case concept_pb_1.default.Type.ENCODING.ENTITY_TYPE:
                    return dependencies_internal_1.EntityTypeImpl.of(typeProto);
                case concept_pb_1.default.Type.ENCODING.RELATION_TYPE:
                    return dependencies_internal_1.RelationTypeImpl.of(typeProto);
                case concept_pb_1.default.Type.ENCODING.ATTRIBUTE_TYPE:
                    return attributeType(typeProto);
                case concept_pb_1.default.Type.ENCODING.THING_TYPE:
                    assert_1.default(typeProto.getRoot());
                    return new dependencies_internal_1.ThingTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                default:
                    throw new dependencies_internal_1.GraknClientError(dependencies_internal_1.ErrorMessage.Concept.BAD_ENCODING.message(typeProto.getEncoding()));
            }
        }
        ConceptProtoReader.thingType = thingType;
        function attributeType(typeProto) {
            switch (typeProto.getValueType()) {
                case concept_pb_1.default.AttributeType.VALUE_TYPE.BOOLEAN:
                    return new dependencies_internal_1.BooleanAttributeTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                case concept_pb_1.default.AttributeType.VALUE_TYPE.LONG:
                    return new dependencies_internal_1.LongAttributeTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                case concept_pb_1.default.AttributeType.VALUE_TYPE.DOUBLE:
                    return new dependencies_internal_1.DoubleAttributeTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                case concept_pb_1.default.AttributeType.VALUE_TYPE.STRING:
                    return new dependencies_internal_1.StringAttributeTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                case concept_pb_1.default.AttributeType.VALUE_TYPE.DATETIME:
                    return new dependencies_internal_1.DateTimeAttributeTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                case concept_pb_1.default.AttributeType.VALUE_TYPE.OBJECT:
                    assert_1.default(typeProto.getRoot());
                    return new dependencies_internal_1.AttributeTypeImpl(typeProto.getLabel(), typeProto.getRoot());
                default:
                    throw new dependencies_internal_1.GraknClientError(dependencies_internal_1.ErrorMessage.Concept.BAD_VALUE_TYPE.message(typeProto.getValueType()));
            }
        }
        ConceptProtoReader.attributeType = attributeType;
    })(ConceptProtoReader = exports.ConceptProtoReader || (exports.ConceptProtoReader = {}));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uY2VwdFByb3RvUmVhZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vY29uY2VwdC9wcm90by9Db25jZXB0UHJvdG9SZWFkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBaUJHOzs7Ozs7Ozs7Ozs7Ozs7O0lBRUgsZ0NBQWdDO0lBRWhDLHdGQUFrRTtJQUNsRSxvREFBNEI7SUFDNUIsOEVBd0JxQztJQUdyQyxJQUFpQixrQkFBa0IsQ0E2RWxDO0lBN0VELFdBQWlCLGtCQUFrQjtRQUMvQixtR0FBbUc7UUFDbkcsaUZBQWlGO1FBQ2pGLFNBQWdCLEtBQUssQ0FBQyxVQUE4QjtZQUNoRCxRQUFRLFVBQVUsQ0FBQyxXQUFXLEVBQUUsRUFBRTtnQkFDOUIsS0FBSyxvQkFBWSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTTtvQkFDbkMsT0FBTyxrQ0FBVSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDckMsS0FBSyxvQkFBWSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsUUFBUTtvQkFDckMsT0FBTyxvQ0FBWSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDdkMsS0FBSyxvQkFBWSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUztvQkFDdEMsT0FBTyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ2pDO29CQUNJLE1BQU0sSUFBSSx3Q0FBZ0IsQ0FBQyxvQ0FBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDdkc7UUFDTCxDQUFDO1FBWGUsd0JBQUssUUFXcEIsQ0FBQTtRQUVELFNBQWdCLFNBQVMsQ0FBQyxVQUE4QjtZQUNwRCxRQUFRLFVBQVUsQ0FBQyxZQUFZLEVBQUUsRUFBRTtnQkFDL0IsS0FBSyxvQkFBWSxDQUFDLGFBQWEsQ0FBQyxV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LEVBQUUsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQ2hGLEtBQUssb0JBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLE1BQU07b0JBQzdDLE9BQU8sSUFBSSwrQ0FBdUIsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQ2xGLEtBQUssb0JBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLE1BQU07b0JBQzdDLE9BQU8sSUFBSSwrQ0FBdUIsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQ2xGLEtBQUssb0JBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLFFBQVE7b0JBQy9DLE9BQU8sSUFBSSxpREFBeUIsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQ3BGLEtBQUssb0JBQVksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLE1BQU07b0JBQzdDLGdCQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7b0JBQzVCLE9BQU8sSUFBSSx5Q0FBaUIsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7Z0JBQzVFO29CQUNJLE1BQU0sSUFBSSx3Q0FBZ0IsQ0FBQyxvQ0FBWSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUM7YUFDekc7UUFDTCxDQUFDO1FBbEJlLGdDQUFhLGdCQWtCNUIsQ0FBQTtJQUNMLENBQUMsRUE3RWdCLGtCQUFrQixHQUFsQiwwQkFBa0IsS0FBbEIsMEJBQWtCLFFBNkVsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG4vLyBUT0RPOiBDYW4gd2UgZ2V0IHJpZCBvZiB0aGlzP1xuXG5pbXBvcnQgQ29uY2VwdFByb3RvIGZyb20gXCJncmFrbmxhYnMtcHJvdG9jb2wvcHJvdG9idWYvY29uY2VwdF9wYlwiO1xuaW1wb3J0IGFzc2VydCBmcm9tIFwiYXNzZXJ0XCI7XG5pbXBvcnQge1xuICAgIEF0dHJpYnV0ZVR5cGVJbXBsLFxuICAgIEJvb2xlYW5BdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBEYXRlVGltZUF0dHJpYnV0ZVR5cGVJbXBsLFxuICAgIERvdWJsZUF0dHJpYnV0ZVR5cGVJbXBsLFxuICAgIExvbmdBdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBTdHJpbmdBdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBUaGluZ0ltcGwsXG4gICAgRW50aXR5SW1wbCxcbiAgICBSZWxhdGlvbkltcGwsXG4gICAgQXR0cmlidXRlSW1wbCxcbiAgICBCb29sZWFuQXR0cmlidXRlSW1wbCxcbiAgICBEYXRlVGltZUF0dHJpYnV0ZUltcGwsXG4gICAgRG91YmxlQXR0cmlidXRlSW1wbCxcbiAgICBMb25nQXR0cmlidXRlSW1wbCxcbiAgICBTdHJpbmdBdHRyaWJ1dGVJbXBsLFxuICAgIFR5cGVJbXBsLFxuICAgIFRoaW5nVHlwZUltcGwsXG4gICAgUm9sZVR5cGVJbXBsLFxuICAgIEVudGl0eVR5cGVJbXBsLFxuICAgIFJlbGF0aW9uVHlwZUltcGwsXG4gICAgR3Jha25DbGllbnRFcnJvcixcbiAgICBFcnJvck1lc3NhZ2UsXG4gICAgQXR0cmlidXRlVHlwZSxcbn0gZnJvbSBcIi4uLy4uL2RlcGVuZGVuY2llc19pbnRlcm5hbFwiO1xuaW1wb3J0IFZhbHVlQ2xhc3MgPSBBdHRyaWJ1dGVUeXBlLlZhbHVlQ2xhc3M7XG5cbmV4cG9ydCBuYW1lc3BhY2UgQ29uY2VwdFByb3RvUmVhZGVyIHtcbiAgICAvLyBUaGlzIG1ldGhvZCBjYW5ub3QgbGl2ZSBpbiBUaGluZ0ltcGwgaXRzZWxmLCBiZWNhdXNlIGRvaW5nIHNvIGNyZWF0ZXMgYSBjaXJjdWxhciBjbGFzcyByZWZlcmVuY2VcbiAgICAvLyBbVGhpbmdJbXBsIC0+IEVudGl0eUltcGwgLT4gVGhpbmdJbXBsXSB3aGljaCBjYXVzZXMgYSBKYXZhU2NyaXB0IHJ1bnRpbWUgZXJyb3JcbiAgICBleHBvcnQgZnVuY3Rpb24gdGhpbmcodGhpbmdQcm90bzogQ29uY2VwdFByb3RvLlRoaW5nKTogVGhpbmdJbXBsIHtcbiAgICAgICAgc3dpdGNoICh0aGluZ1Byb3RvLmdldEVuY29kaW5nKCkpIHtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLlRoaW5nLkVOQ09ESU5HLkVOVElUWTpcbiAgICAgICAgICAgICAgICByZXR1cm4gRW50aXR5SW1wbC5vZih0aGluZ1Byb3RvKTtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLlRoaW5nLkVOQ09ESU5HLlJFTEFUSU9OOlxuICAgICAgICAgICAgICAgIHJldHVybiBSZWxhdGlvbkltcGwub2YodGhpbmdQcm90byk7XG4gICAgICAgICAgICBjYXNlIENvbmNlcHRQcm90by5UaGluZy5FTkNPRElORy5BVFRSSUJVVEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZSh0aGluZ1Byb3RvKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdyYWtuQ2xpZW50RXJyb3IoRXJyb3JNZXNzYWdlLkNvbmNlcHQuQkFEX0VOQ09ESU5HLm1lc3NhZ2UodGhpbmdQcm90by5nZXRFbmNvZGluZygpKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gYXR0cmlidXRlKHRoaW5nUHJvdG86IENvbmNlcHRQcm90by5UaGluZyk6IEF0dHJpYnV0ZUltcGw8VmFsdWVDbGFzcz4ge1xuICAgICAgICBzd2l0Y2ggKHRoaW5nUHJvdG8uZ2V0VmFsdWVUeXBlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5CT09MRUFOOlxuICAgICAgICAgICAgICAgIHJldHVybiBCb29sZWFuQXR0cmlidXRlSW1wbC5vZih0aGluZ1Byb3RvKTtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5MT05HOlxuICAgICAgICAgICAgICAgIHJldHVybiBMb25nQXR0cmlidXRlSW1wbC5vZih0aGluZ1Byb3RvKTtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5ET1VCTEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIERvdWJsZUF0dHJpYnV0ZUltcGwub2YodGhpbmdQcm90byk7XG4gICAgICAgICAgICBjYXNlIENvbmNlcHRQcm90by5BdHRyaWJ1dGVUeXBlLlZBTFVFX1RZUEUuU1RSSU5HOlxuICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmdBdHRyaWJ1dGVJbXBsLm9mKHRoaW5nUHJvdG8pO1xuICAgICAgICAgICAgY2FzZSBDb25jZXB0UHJvdG8uQXR0cmlidXRlVHlwZS5WQUxVRV9UWVBFLkRBVEVUSU1FOlxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRlVGltZUF0dHJpYnV0ZUltcGwub2YodGhpbmdQcm90byk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBHcmFrbkNsaWVudEVycm9yKEVycm9yTWVzc2FnZS5Db25jZXB0LkJBRF9WQUxVRV9UWVBFLm1lc3NhZ2UodGhpbmdQcm90by5nZXRWYWx1ZVR5cGUoKSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHR5cGUodHlwZVByb3RvOiBDb25jZXB0UHJvdG8uVHlwZSk6IFR5cGVJbXBsIHtcbiAgICAgICAgc3dpdGNoICh0eXBlUHJvdG8uZ2V0RW5jb2RpbmcoKSkge1xuICAgICAgICAgICAgY2FzZSBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5ST0xFX1RZUEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFJvbGVUeXBlSW1wbC5vZih0eXBlUHJvdG8pO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpbmdUeXBlKHR5cGVQcm90byk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gdGhpbmdUeXBlKHR5cGVQcm90bzogQ29uY2VwdFByb3RvLlR5cGUpOiBUaGluZ1R5cGVJbXBsIHtcbiAgICAgICAgc3dpdGNoICh0eXBlUHJvdG8uZ2V0RW5jb2RpbmcoKSkge1xuICAgICAgICAgICAgY2FzZSBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5FTlRJVFlfVFlQRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gRW50aXR5VHlwZUltcGwub2YodHlwZVByb3RvKTtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLlR5cGUuRU5DT0RJTkcuUkVMQVRJT05fVFlQRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gUmVsYXRpb25UeXBlSW1wbC5vZih0eXBlUHJvdG8pO1xuICAgICAgICAgICAgY2FzZSBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5BVFRSSUJVVEVfVFlQRTpcbiAgICAgICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlVHlwZSh0eXBlUHJvdG8pO1xuICAgICAgICAgICAgY2FzZSBDb25jZXB0UHJvdG8uVHlwZS5FTkNPRElORy5USElOR19UWVBFOlxuICAgICAgICAgICAgICAgIGFzc2VydCh0eXBlUHJvdG8uZ2V0Um9vdCgpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFRoaW5nVHlwZUltcGwodHlwZVByb3RvLmdldExhYmVsKCksIHR5cGVQcm90by5nZXRSb290KCkpO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgR3Jha25DbGllbnRFcnJvcihFcnJvck1lc3NhZ2UuQ29uY2VwdC5CQURfRU5DT0RJTkcubWVzc2FnZSh0eXBlUHJvdG8uZ2V0RW5jb2RpbmcoKSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGF0dHJpYnV0ZVR5cGUodHlwZVByb3RvOiBDb25jZXB0UHJvdG8uVHlwZSk6IEF0dHJpYnV0ZVR5cGVJbXBsIHtcbiAgICAgICAgc3dpdGNoICh0eXBlUHJvdG8uZ2V0VmFsdWVUeXBlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5CT09MRUFOOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQm9vbGVhbkF0dHJpYnV0ZVR5cGVJbXBsKHR5cGVQcm90by5nZXRMYWJlbCgpLCB0eXBlUHJvdG8uZ2V0Um9vdCgpKTtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5MT05HOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTG9uZ0F0dHJpYnV0ZVR5cGVJbXBsKHR5cGVQcm90by5nZXRMYWJlbCgpLCB0eXBlUHJvdG8uZ2V0Um9vdCgpKTtcbiAgICAgICAgICAgIGNhc2UgQ29uY2VwdFByb3RvLkF0dHJpYnV0ZVR5cGUuVkFMVUVfVFlQRS5ET1VCTEU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEb3VibGVBdHRyaWJ1dGVUeXBlSW1wbCh0eXBlUHJvdG8uZ2V0TGFiZWwoKSwgdHlwZVByb3RvLmdldFJvb3QoKSk7XG4gICAgICAgICAgICBjYXNlIENvbmNlcHRQcm90by5BdHRyaWJ1dGVUeXBlLlZBTFVFX1RZUEUuU1RSSU5HOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nQXR0cmlidXRlVHlwZUltcGwodHlwZVByb3RvLmdldExhYmVsKCksIHR5cGVQcm90by5nZXRSb290KCkpO1xuICAgICAgICAgICAgY2FzZSBDb25jZXB0UHJvdG8uQXR0cmlidXRlVHlwZS5WQUxVRV9UWVBFLkRBVEVUSU1FOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZVRpbWVBdHRyaWJ1dGVUeXBlSW1wbCh0eXBlUHJvdG8uZ2V0TGFiZWwoKSwgdHlwZVByb3RvLmdldFJvb3QoKSk7XG4gICAgICAgICAgICBjYXNlIENvbmNlcHRQcm90by5BdHRyaWJ1dGVUeXBlLlZBTFVFX1RZUEUuT0JKRUNUOlxuICAgICAgICAgICAgICAgIGFzc2VydCh0eXBlUHJvdG8uZ2V0Um9vdCgpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEF0dHJpYnV0ZVR5cGVJbXBsKHR5cGVQcm90by5nZXRMYWJlbCgpLCB0eXBlUHJvdG8uZ2V0Um9vdCgpKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEdyYWtuQ2xpZW50RXJyb3IoRXJyb3JNZXNzYWdlLkNvbmNlcHQuQkFEX1ZBTFVFX1RZUEUubWVzc2FnZSh0eXBlUHJvdG8uZ2V0VmFsdWVUeXBlKCkpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==