/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/ConceptManager", ["require", "exports", "grakn-client/dependencies_internal", "graknlabs-protocol/protobuf/concept_pb", "graknlabs-protocol/protobuf/transaction_pb"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ConceptManager = void 0;
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    const concept_pb_1 = __importDefault(require("graknlabs-protocol/protobuf/concept_pb"));
    const transaction_pb_1 = __importDefault(require("graknlabs-protocol/protobuf/transaction_pb"));
    class ConceptManager {
        constructor(rpcTransaction) {
            this._rpcTransaction = rpcTransaction;
        }
        getRootThingType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("thing");
            });
        }
        getRootEntityType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("entity");
            });
        }
        getRootRelationType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("relation");
            });
        }
        getRootAttributeType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("attribute");
            });
        }
        putEntityType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutEntityTypeReq(new concept_pb_1.default.ConceptManager.PutEntityType.Req().setLabel(label));
                const res = yield this.execute(req);
                return dependencies_internal_1.EntityTypeImpl.of(res.getPutEntityTypeRes().getEntityType());
            });
        }
        getEntityType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const type = yield this.getType(label);
                if (type instanceof dependencies_internal_1.EntityTypeImpl)
                    return type;
                else
                    return null;
            });
        }
        putRelationType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutRelationTypeReq(new concept_pb_1.default.ConceptManager.PutRelationType.Req().setLabel(label));
                const res = yield this.execute(req);
                return dependencies_internal_1.RelationTypeImpl.of(res.getPutRelationTypeRes().getRelationType());
            });
        }
        getRelationType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const type = yield this.getType(label);
                if (type instanceof dependencies_internal_1.RelationTypeImpl)
                    return type;
                else
                    return null;
            });
        }
        putAttributeType(label, valueType) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutAttributeTypeReq(new concept_pb_1.default.ConceptManager.PutAttributeType.Req()
                    .setLabel(label)
                    .setValueType(dependencies_internal_1.ConceptProtoBuilder.valueType(valueType)));
                const res = yield this.execute(req);
                return dependencies_internal_1.ConceptProtoReader.attributeType(res.getPutAttributeTypeRes().getAttributeType());
            });
        }
        getAttributeType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const type = yield this.getType(label);
                if (type instanceof dependencies_internal_1.AttributeTypeImpl)
                    return type;
                else
                    return null;
            });
        }
        getThing(iid) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setGetThingReq(new concept_pb_1.default.ConceptManager.GetThing.Req().setIid(iid));
                const res = yield this.execute(req);
                if (res.getGetThingRes().getResCase() === concept_pb_1.default.ConceptManager.GetThing.Res.ResCase.THING)
                    return dependencies_internal_1.ConceptProtoReader.thing(res.getGetThingRes().getThing());
                else
                    return null;
            });
        }
        getType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setGetTypeReq(new concept_pb_1.default.ConceptManager.GetType.Req().setLabel(label));
                const res = yield this.execute(req);
                if (res.getGetTypeRes().getResCase() === concept_pb_1.default.ConceptManager.GetType.Res.ResCase.TYPE)
                    return dependencies_internal_1.ConceptProtoReader.type(res.getGetTypeRes().getType());
                else
                    return null;
            });
        }
        execute(conceptManagerReq) {
            return __awaiter(this, void 0, void 0, function* () {
                const transactionReq = new transaction_pb_1.default.Transaction.Req()
                    .setConceptManagerReq(conceptManagerReq);
                return yield this._rpcTransaction.execute(transactionReq, res => res.getConceptManagerRes());
            });
        }
    }
    exports.ConceptManager = ConceptManager;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uY2VwdE1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb25jZXB0L0NvbmNlcHRNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUVILDhFQWFrQztJQUNsQyx3RkFBa0U7SUFDbEUsZ0dBQTBFO0lBRTFFLE1BQWEsY0FBYztRQUd2QixZQUFhLGNBQThCO1lBQ3ZDLElBQUksQ0FBQyxlQUFlLEdBQUcsY0FBYyxDQUFDO1FBQzFDLENBQUM7UUFFSyxnQkFBZ0I7O2dCQUNsQixPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQWMsQ0FBQztZQUNwRCxDQUFDO1NBQUE7UUFFSyxpQkFBaUI7O2dCQUNuQixPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQWUsQ0FBQztZQUN0RCxDQUFDO1NBQUE7UUFFSyxtQkFBbUI7O2dCQUNyQixPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQWlCLENBQUM7WUFDMUQsQ0FBQztTQUFBO1FBRUssb0JBQW9COztnQkFDdEIsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFrQixDQUFDO1lBQzVELENBQUM7U0FBQTtRQUVLLGFBQWEsQ0FBQyxLQUFhOztnQkFDN0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxvQkFBWSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUU7cUJBQzVDLG1CQUFtQixDQUFDLElBQUksb0JBQVksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUM5RixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BDLE9BQU8sc0NBQWMsQ0FBQyxFQUFFLENBQUMs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LE9BQU8sQ0FBQyxLQUFhOztnQkFDdkIsTUFBTSxHQUFHLEdBQUcsSUFBSSxvQkFBWSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUU7cUJBQzVDLGFBQWEsQ0FBQyxJQUFJLG9CQUFZLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDbEYsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNwQyxJQUFJLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxvQkFBWSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJO29CQUN6RixPQUFPLDBDQUFrQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQzs7b0JBRTlELE9BQU8sSUFBSSxDQUFDO1lBQ3BCLENBQUM7U0FBQTtRQUVhLE9BQU8sQ0FBQyxpQkFBa0Q7O2dCQUNwRSxNQUFNLGNBQWMsR0FBRyxJQUFJLHdCQUFnQixDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUU7cUJBQ3hELG9CQUFvQixDQUFDLGlCQUFpQixDQUFDLENBQUM7Z0JBQzdDLE9BQU8sTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO1lBQ2pHLENBQUM7U0FBQTtLQUNKO0lBekZELHdDQXlGQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1xuICAgIENvbmNlcHRQcm90b0J1aWxkZXIsXG4gICAgQ29uY2VwdFByb3RvUmVhZGVyLFxuICAgIFRoaW5nVHlwZSxcbiAgICBFbnRpdHlUeXBlLFxuICAgIFJlbGF0aW9uVHlwZSxcbiAgICBBdHRyaWJ1dGVUeXBlLFxuICAgIEVudGl0eVR5cGVJbXBsLFxuICAgIFR5cGUsXG4gICAgUlBDVHJhbnNhY3Rpb24sXG4gICAgUmVsYXRpb25UeXBlSW1wbCxcbiAgICBBdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBUaGluZyxcbn0gZnJvbSBcIi4uL2RlcGVuZGVuY2llc19pbnRlcm5hbFwiO1xuaW1wb3J0IENvbmNlcHRQcm90byBmcm9tIFwiZ3Jha25sYWJzLXByb3RvY29sL3Byb3RvYnVmL2NvbmNlcHRfcGJcIjtcbmltcG9ydCBUcmFuc2FjdGlvblByb3RvIGZyb20gXCJncmFrbmxhYnMtcHJvdG9jb2wvcHJvdG9idWYvdHJhbnNhY3Rpb25fcGJcIjtcblxuZXhwb3J0IGNsYXNzIENvbmNlcHRNYW5hZ2VyIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9ycGNUcmFuc2FjdGlvbjogUlBDVHJhbnNhY3Rpb247XG5cbiAgICBjb25zdHJ1Y3RvciAocnBjVHJhbnNhY3Rpb246IFJQQ1RyYW5zYWN0aW9uKSB7XG4gICAgICAgIHRoaXMuX3JwY1RyYW5zYWN0aW9uID0gcnBjVHJhbnNhY3Rpb247XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Um9vdFRoaW5nVHlwZSgpOiBQcm9taXNlPFRoaW5nVHlwZT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRUeXBlKFwidGhpbmdcIikgYXMgVGhpbmdUeXBlO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFJvb3RFbnRpdHlUeXBlKCk6IFByb21pc2U8RW50aXR5VHlwZT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRUeXBlKFwiZW50aXR5XCIpIGFzIEVudGl0eVR5cGU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Um9vdFJlbGF0aW9uVHlwZSgpOiBQcm9taXNlPFJlbGF0aW9uVHlwZT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRUeXBlKFwicmVsYXRpb25cIikgYXMgUmVsYXRpb25UeXBlO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFJvb3RBdHRyaWJ1dGVUeXBlKCk6IFByb21pc2U8QXR0cmlidXRlVHlwZT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRUeXBlKFwiYXR0cmlidXRlXCIpIGFzIEF0dHJpYnV0ZVR5cGU7XG4gICAgfVxuXG4gICAgYXN5bmMgcHV0RW50aXR5VHlwZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxFbnRpdHlUeXBlPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRQdXRFbnRpdHlUeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUHV0RW50aXR5VHlwZS5SZXEoKS5zZXRMYWJlbChsYWJlbCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgcmV0dXJuIEVudGl0eVR5cGVJbXBsLm9mKHJlcy5nZXRQdXRFbnRpdHlUeXBlUmVzKCkuZ2V0RW50aXR5VHlwZSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRFbnRpdHlUeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPEVudGl0eVR5cGU+IHtcbiAgICAgICAgY29uc3QgdHlwZSA9IGF3YWl0IHRoaXMuZ2V0VHlwZShsYWJlbCk7XG4gICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgRW50aXR5VHlwZUltcGwpIHJldHVybiB0eXBlIGFzIEVudGl0eVR5cGU7XG4gICAgICAgIGVsc2UgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgcHV0UmVsYXRpb25UeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPFJlbGF0aW9uVHlwZT4ge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgQ29uY2VwdFByb3RvLkNvbmNlcHRNYW5hZ2VyLlJlcSgpXG4gICAgICAgICAgICAuc2V0UHV0UmVsYXRpb25UeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUHV0UmVsYXRpb25UeXBlLlJlcSgpLnNldExhYmVsKGxhYmVsKSk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShyZXEpO1xuICAgICAgICByZXR1cm4gUmVsYXRpb25UeXBlSW1wbC5vZihyZXMuZ2V0UHV0UmVsYXRpb25UeXBlUmVzKCkuZ2V0UmVsYXRpb25UeXBlKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFJlbGF0aW9uVHlwZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxSZWxhdGlvblR5cGU+IHtcbiAgICAgICAgY29uc3QgdHlwZSA9IGF3YWl0IHRoaXMuZ2V0VHlwZShsYWJlbCk7XG4gICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgUmVsYXRpb25UeXBlSW1wbCkgcmV0dXJuIHR5cGUgYXMgUmVsYXRpb25UeXBlO1xuICAgICAgICBlbHNlIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGFzeW5jIHB1dEF0dHJpYnV0ZVR5cGUobGFiZWw6IHN0cmluZywgdmFsdWVUeXBlOiBBdHRyaWJ1dGVUeXBlLlZhbHVlVHlwZSk6IFByb21pc2U8QXR0cmlidXRlVHlwZT4ge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgQ29uY2VwdFByb3RvLkNvbmNlcHRNYW5hZ2VyLlJlcSgpXG4gICAgICAgICAgICAuc2V0UHV0QXR0cmlidXRlVHlwZVJlcShuZXcgQ29uY2VwdFByb3RvLkNvbmNlcHRNYW5hZ2VyLlB1dEF0dHJpYnV0ZVR5cGUuUmVxKClcbiAgICAgICAgICAgICAgICAuc2V0TGFiZWwobGFiZWwpXG4gICAgICAgICAgICAgICAgLnNldFZhbHVlVHlwZShDb25jZXB0UHJvdG9CdWlsZGVyLnZhbHVlVHlwZSh2YWx1ZVR5cGUpKSk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShyZXEpO1xuICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvUmVhZGVyLmF0dHJpYnV0ZVR5cGUocmVzLmdldFB1dEF0dHJpYnV0ZVR5cGVSZXMoKS5nZXRBdHRyaWJ1dGVUeXBlKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldEF0dHJpYnV0ZVR5cGUobGFiZWw6IHN0cmluZyk6IFByb21pc2U8QXR0cmlidXRlVHlwZT4ge1xuICAgICAgICBjb25zdCB0eXBlID0gYXdhaXQgdGhpcy5nZXRUeXBlKGxhYmVsKTtcbiAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBBdHRyaWJ1dGVUeXBlSW1wbCkgcmV0dXJuIHR5cGUgYXMgQXR0cmlidXRlVHlwZTtcbiAgICAgICAgZWxzZSByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUaGluZyhpaWQ6IHN0cmluZyk6IFByb21pc2U8VGhpbmc+IHtcbiAgICAgICAgY29uc3QgcmVxID0gbmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldEdldFRoaW5nUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0VGhpbmcuUmVxKCkuc2V0SWlkKGlpZCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRHZXRUaGluZ1JlcygpLmdldFJlc0Nhc2UoKSA9PT0gQ29uY2VwdFByb3RvLkNvbmNlcHRNYW5hZ2VyLkdldFRoaW5nLlJlcy5SZXNDYXNlLlRISU5HKVxuICAgICAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90b1JlYWRlci50aGluZyhyZXMuZ2V0R2V0VGhpbmdSZXMoKS5nZXRUaGluZygpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VHlwZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxUeXBlPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRHZXRUeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0VHlwZS5SZXEoKS5zZXRMYWJlbChsYWJlbCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRHZXRUeXBlUmVzKCkuZ2V0UmVzQ2FzZSgpID09PSBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0VHlwZS5SZXMuUmVzQ2FzZS5UWVBFKVxuICAgICAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90b1JlYWRlci50eXBlKHJlcy5nZXRHZXRUeXBlUmVzKCkuZ2V0VHlwZSgpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBleGVjdXRlKGNvbmNlcHRNYW5hZ2VyUmVxOiBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKTogUHJvbWlzZTxDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVzPiB7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uUmVxID0gbmV3IFRyYW5zYWN0aW9uUHJvdG8uVHJhbnNhY3Rpb24uUmVxKClcbiAgICAgICAgICAgIC5zZXRDb25jZXB0TWFuYWdlclJlcShjb25jZXB0TWFuYWdlclJlcSk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9ycGNUcmFuc2FjdGlvbi5leGVjdXRlKHRyYW5zYWN0aW9uUmVxLCByZXMgPT4gcmVzLmdldENvbmNlcHRNYW5hZ2VyUmVzKCkpO1xuICAgIH1cbn1cbiJdfQ==