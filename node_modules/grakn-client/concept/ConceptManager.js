/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/ConceptManager", ["require", "exports", "graknlabs-grpc-protocol/protobuf/concept_pb", "graknlabs-grpc-protocol/protobuf/transaction_pb", "grakn-client/concept/Type/Impl/EntityTypeImpl", "grakn-client/concept/Type/Impl/TypeImpl", "grakn-client/concept/Type/Impl/RuleImpl", "grakn-client/concept/Type/Impl/RelationTypeImpl", "grakn-client/concept/Type/Impl/AttributeTypeImpl", "grakn-client/concept/Proto/ConceptProtoReader"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ConceptManager = void 0;
    const concept_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/concept_pb"));
    var ProtoConceptManager = concept_pb_1.default.ConceptManager;
    const transaction_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/transaction_pb"));
    const EntityTypeImpl_1 = require("grakn-client/concept/Type/Impl/EntityTypeImpl");
    const TypeImpl_1 = require("grakn-client/concept/Type/Impl/TypeImpl");
    const RuleImpl_1 = require("grakn-client/concept/Type/Impl/RuleImpl");
    const RelationTypeImpl_1 = require("grakn-client/concept/Type/Impl/RelationTypeImpl");
    const AttributeTypeImpl_1 = require("grakn-client/concept/Type/Impl/AttributeTypeImpl");
    const ConceptProtoReader_1 = require("grakn-client/concept/Proto/ConceptProtoReader");
    class ConceptManager {
        constructor(rpcTransaction) {
            this._rpcTransaction = rpcTransaction;
        }
        getRootThingType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("thing");
            });
        }
        getRootEntityType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("entity");
            });
        }
        getRootRelationType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("relation");
            });
        }
        getRootAttributeType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("attribute");
            });
        }
        putEntityType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setPutEntityTypeReq(new ProtoConceptManager.PutEntityType.Req().setLabel(label));
                const res = yield this.execute(req);
                return EntityTypeImpl_1.EntityTypeImpl.of(res.getPutEntityTypeRes().getEntityType());
            });
        }
        getEntityType(label) {
            const concept = this.getType(label);
            if (concept instanceof EntityTypeImpl_1.EntityTypeImpl)
                return concept;
            return null;
        }
        putRelationType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setPutRelationTypeReq(new ProtoConceptManager.PutRelationType.Req().setLabel(label));
                const res = yield this.execute(req);
                return RelationTypeImpl_1.RelationTypeImpl.of(res.getPutRelationTypeRes().getRelationType());
            });
        }
        getRelationType(label) {
            const concept = this.getType(label);
            if (concept instanceof RelationTypeImpl_1.RelationTypeImpl)
                return concept;
            return null;
        }
        putAttributeType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setPutAttributeTypeReq(new ProtoConceptManager.PutAttributeType.Req().setLabel(label));
                const res = yield this.execute(req);
                return AttributeTypeImpl_1.AttributeTypeImpl.of(res.getPutAttributeTypeRes().getAttributeType());
            });
        }
        getAttributeType(label) {
            const concept = this.getType(label);
            if (concept instanceof AttributeTypeImpl_1.AttributeTypeImpl)
                return concept;
            return null;
        }
        putRule(label, when, then) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setPutRuleReq(new ProtoConceptManager.PutRule.Req()
                    .setLabel(label)
                    .setWhen(when)
                    .setThen(then));
                const res = yield this.execute(req);
                return RuleImpl_1.RuleImpl.of(res.getPutRuleRes().getRule());
            });
        }
        getThing(iid) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setGetThingReq(new ProtoConceptManager.GetThing.Req().setIid(iid));
                const res = yield this.execute(req);
                if (res.getGetThingRes().getResCase() === ProtoConceptManager.GetThing.Res.ResCase.THING)
                    return ConceptProtoReader_1.ConceptProtoReader.thing(res.getGetThingRes().getThing());
                else
                    return null;
            });
        }
        getType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setGetTypeReq(new ProtoConceptManager.GetType.Req().setLabel(label));
                const res = yield this.execute(req);
                if (res.getGetTypeRes().getResCase() === ProtoConceptManager.GetType.Res.ResCase.TYPE)
                    return TypeImpl_1.TypeImpl.of(res.getGetTypeRes().getType());
                else
                    return null;
            });
        }
        getRule(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new ProtoConceptManager.Req()
                    .setGetRuleReq(new ProtoConceptManager.GetRule.Req().setLabel(label));
                const res = yield this.execute(req);
                if (res.getGetRuleRes().getResCase() === ProtoConceptManager.GetRule.Res.ResCase.RULE)
                    return RuleImpl_1.RuleImpl.of(res.getGetRuleRes().getRule());
                return null;
            });
        }
        execute(conceptManagerReq) {
            return __awaiter(this, void 0, void 0, function* () {
                const transactionReq = new transaction_pb_1.default.Transaction.Req()
                    .setConceptManagerReq(conceptManagerReq);
                return yield this._rpcTransaction.execute(transactionReq, res => res.getConceptManagerRes());
            });
        }
    }
    exports.ConceptManager = ConceptManager;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uY2VwdE1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb25jZXB0L0NvbmNlcHRNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQU1ILDZGQUF1RTtJQUN2RSxJQUFPLG1CQUFtQixHQUFHLG9CQUFZLENBQUMsY0FBYyxDQUFDO0lBQ3pELHFHQUErRTtJQUMvRSxrRkFBNEQ7SUFFNUQsc0VBQWdEO0lBRWhELHNFQUFnRDtJQUVoRCxzRkFBZ0U7SUFDaEUsd0ZBQWtFO0lBR2xFLHNGQUFnRTtJQUVoRSxNQUFhLGNBQWM7UUFHdkIsWUFBYSxjQUE4QjtZQUN2QyxJQUFJLENBQUMsZUFBZSxHQUFHLGNBQWMsQ0FBQztRQUMxQyxDQUFDO1FBRUssZ0JBQWdCOztnQkFDbEIsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFjLENBQUM7WUFDcEQsQ0FBQztTQUFBO1FBRUssaUJBQWlCOztnQkFDbkIsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFlLENBQUM7WUFDdEQsQ0FBQztTQUFBO1FBRUssbUJBQW1COztnQkFDckIsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFpQixDQUFDO1lBQzFELENBQUM7U0FBQTtRQUVLLG9CQUFvQjs7Z0JBQ3RCLE9BQU8sTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBa0IsQ0FBQztZQUM1RCxDQUFDO1NBQUE7UUFFSyxhQUFhLENBQUMsS0FBYTs7Z0JBQzdCLE1BQU0sR0FBRyxHQUFHLElBQUksbUJBQW1CLENBQUMsR0FBRyxFQUFFO3FCQUNwQyxtQkFBbUIsQ0FBQyxJQUFJLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFD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QUMxRSxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BDLElBQUksR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDLFVBQVUsRUFBRSxLQUFLLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUk7b0JBQUUsT0FBTyxtQkFBUSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztnQkFDekksT0FBTyxJQUFJLENBQUM7WUFDaEIsQ0FBQztTQUFBO1FBRWEsT0FBTyxDQUFDLGlCQUEwQzs7Z0JBQzVELE1BQU0sY0FBYyxHQUFHLElBQUksd0JBQWdCLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRTtxQkFDeEQsb0JBQW9CLENBQUMsaUJBQWlCLENBQUMsQ0FBQztnQkFDN0MsT0FBTyxNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUM7WUFDakcsQ0FBQztTQUFBO0tBQ0o7SUF6R0Qsd0NBeUdDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IFRoaW5nVHlwZSB9IGZyb20gXCIuL1R5cGUvVGhpbmdUeXBlXCI7XG5pbXBvcnQgeyBFbnRpdHlUeXBlIH0gZnJvbSBcIi4vVHlwZS9FbnRpdHlUeXBlXCI7XG5pbXBvcnQgeyBSZWxhdGlvblR5cGUgfSBmcm9tIFwiLi9UeXBlL1JlbGF0aW9uVHlwZVwiO1xuaW1wb3J0IHsgQXR0cmlidXRlVHlwZSB9IGZyb20gXCIuL1R5cGUvQXR0cmlidXRlVHlwZVwiO1xuaW1wb3J0IENvbmNlcHRQcm90byBmcm9tIFwiZ3Jha25sYWJzLWdycGMtcHJvdG9jb2wvcHJvdG9idWYvY29uY2VwdF9wYlwiO1xuaW1wb3J0IFByb3RvQ29uY2VwdE1hbmFnZXIgPSBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXI7XG5pbXBvcnQgVHJhbnNhY3Rpb25Qcm90byBmcm9tIFwiZ3Jha25sYWJzLWdycGMtcHJvdG9jb2wvcHJvdG9idWYvdHJhbnNhY3Rpb25fcGJcIjtcbmltcG9ydCB7IEVudGl0eVR5cGVJbXBsIH0gZnJvbSBcIi4vVHlwZS9JbXBsL0VudGl0eVR5cGVJbXBsXCI7XG5pbXBvcnQgeyBUeXBlIH0gZnJvbSBcIi4vVHlwZS9UeXBlXCI7XG5pbXBvcnQgeyBUeXBlSW1wbCB9IGZyb20gXCIuL1R5cGUvSW1wbC9UeXBlSW1wbFwiO1xuaW1wb3J0IHsgUnVsZSB9IGZyb20gXCIuL1R5cGUvUnVsZVwiO1xuaW1wb3J0IHsgUnVsZUltcGwgfSBmcm9tIFwiLi9UeXBlL0ltcGwvUnVsZUltcGxcIjtcbmltcG9ydCB7IFJQQ1RyYW5zYWN0aW9uIH0gZnJvbSBcIi4uL3JwYy9SUENUcmFuc2FjdGlvblwiO1xuaW1wb3J0IHsgUmVsYXRpb25UeXBlSW1wbCB9IGZyb20gXCIuL1R5cGUvSW1wbC9SZWxhdGlvblR5cGVJbXBsXCI7XG5pbXBvcnQgeyBBdHRyaWJ1dGVUeXBlSW1wbCB9IGZyb20gXCIuL1R5cGUvSW1wbC9BdHRyaWJ1dGVUeXBlSW1wbFwiO1xuaW1wb3J0IHsgVGhpbmcgfSBmcm9tIFwiLi9UaGluZy9UaGluZ1wiO1xuaW1wb3J0IHsgVGhpbmdJbXBsIH0gZnJvbSBcIi4vVGhpbmcvSW1wbC9UaGluZ0ltcGxcIjtcbmltcG9ydCB7IENvbmNlcHRQcm90b1JlYWRlciB9IGZyb20gXCIuL1Byb3RvL0NvbmNlcHRQcm90b1JlYWRlclwiO1xuXG5leHBvcnQgY2xhc3MgQ29uY2VwdE1hbmFnZXIge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3JwY1RyYW5zYWN0aW9uOiBSUENUcmFuc2FjdGlvbjtcblxuICAgIGNvbnN0cnVjdG9yIChycGNUcmFuc2FjdGlvbjogUlBDVHJhbnNhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5fcnBjVHJhbnNhY3Rpb24gPSBycGNUcmFuc2FjdGlvbjtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRSb290VGhpbmdUeXBlKCk6IFByb21pc2U8VGhpbmdUeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJ0aGluZ1wiKSBhcyBUaGluZ1R5cGU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Um9vdEVudGl0eVR5cGUoKTogUHJvbWlzZTxFbnRpdHlUeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJlbnRpdHlcIikgYXMgRW50aXR5VHlwZTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRSb290UmVsYXRpb25UeXBlKCk6IFByb21pc2U8UmVsYXRpb25UeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJyZWxhdGlvblwiKSBhcyBSZWxhdGlvblR5cGU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Um9vdEF0dHJpYnV0ZVR5cGUoKTogUHJvbWlzZTxBdHRyaWJ1dGVUeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJhdHRyaWJ1dGVcIikgYXMgQXR0cmlidXRlVHlwZTtcbiAgICB9XG5cbiAgICBhc3luYyBwdXRFbnRpdHlUeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPEVudGl0eVR5cGU+IHtcbiAgICAgICAgY29uc3QgcmVxID0gbmV3IFByb3RvQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRQdXRFbnRpdHlUeXBlUmVxKG5ldyBQcm90b0NvbmNlcHRNYW5hZ2VyLlB1dEVudGl0eVR5cGUuUmVxKCkuc2V0TGFiZWwobGFiZWwpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIHJldHVybiBFbnRpdHlUeXBlSW1wbC5vZihyZXMuZ2V0UHV0RW50aXR5VHlwZVJlcygpLmdldEVudGl0eVR5cGUoKSk7XG4gICAgfVxuXG4gICAgZ2V0RW50aXR5VHlwZShsYWJlbDogc3RyaW5nKTogRW50aXR5VHlwZSB8IG51bGwge1xuICAgICAgICBjb25zdCBjb25jZXB0ID0gdGhpcy5nZXRUeXBlKGxhYmVsKTtcbiAgICAgICAgaWYgKGNvbmNlcHQgaW5zdGFuY2VvZiBFbnRpdHlUeXBlSW1wbCkgcmV0dXJuIGNvbmNlcHQgYXMgRW50aXR5VHlwZTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgcHV0UmVsYXRpb25UeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPFJlbGF0aW9uVHlwZT4ge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgUHJvdG9Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldFB1dFJlbGF0aW9uVHlwZVJlcShuZXcgUHJvdG9Db25jZXB0TWFuYWdlci5QdXRSZWxhdGlvblR5cGUuUmVxKCkuc2V0TGFiZWwobGFiZWwpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIHJldHVybiBSZWxhdGlvblR5cGVJbXBsLm9mKHJlcy5nZXRQdXRSZWxhdGlvblR5cGVSZXMoKS5nZXRSZWxhdGlvblR5cGUoKSk7XG4gICAgfVxuXG4gICAgZ2V0UmVsYXRpb25UeXBlKGxhYmVsOiBzdHJpbmcpOiBSZWxhdGlvblR5cGUgfCBudWxsIHtcbiAgICAgICAgY29uc3QgY29uY2VwdCA9IHRoaXMuZ2V0VHlwZShsYWJlbCk7XG4gICAgICAgIGlmIChjb25jZXB0IGluc3RhbmNlb2YgUmVsYXRpb25UeXBlSW1wbCkgcmV0dXJuIGNvbmNlcHQgYXMgUmVsYXRpb25UeXBlO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBhc3luYyBwdXRBdHRyaWJ1dGVUeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPEF0dHJpYnV0ZVR5cGU+IHtcbiAgICAgICAgY29uc3QgcmVxID0gbmV3IFByb3RvQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRQdXRBdHRyaWJ1dGVUeXBlUmVxKG5ldyBQcm90b0NvbmNlcHRNYW5hZ2VyLlB1dEF0dHJpYnV0ZVR5cGUuUmVxKCkuc2V0TGFiZWwobGFiZWwpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIHJldHVybiBBdHRyaWJ1dGVUeXBlSW1wbC5vZihyZXMuZ2V0UHV0QXR0cmlidXRlVHlwZVJlcygpLmdldEF0dHJpYnV0ZVR5cGUoKSk7XG4gICAgfVxuXG4gICAgZ2V0QXR0cmlidXRlVHlwZShsYWJlbDogc3RyaW5nKTogQXR0cmlidXRlVHlwZSB8IG51bGwge1xuICAgICAgICBjb25zdCBjb25jZXB0ID0gdGhpcy5nZXRUeXBlKGxhYmVsKTtcbiAgICAgICAgaWYgKGNvbmNlcHQgaW5zdGFuY2VvZiBBdHRyaWJ1dGVUeXBlSW1wbCkgcmV0dXJuIGNvbmNlcHQgYXMgQXR0cmlidXRlVHlwZTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgcHV0UnVsZShsYWJlbDogc3RyaW5nLCB3aGVuOiBzdHJpbmcsIHRoZW46IHN0cmluZyk6IFByb21pc2U8UnVsZT4ge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgUHJvdG9Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldFB1dFJ1bGVSZXEobmV3IFByb3RvQ29uY2VwdE1hbmFnZXIuUHV0UnVsZS5SZXEoKVxuICAgICAgICAgICAgICAgICAgICAuc2V0TGFiZWwobGFiZWwpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRXaGVuKHdoZW4pXG4gICAgICAgICAgICAgICAgICAgIC5zZXRUaGVuKHRoZW4pKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIHJldHVybiBSdWxlSW1wbC5vZihyZXMuZ2V0UHV0UnVsZVJlcygpLmdldFJ1bGUoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VGhpbmcoaWlkOiBzdHJpbmcpOiBQcm9taXNlPFRoaW5nIHwgbnVsbD4ge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgUHJvdG9Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldEdldFRoaW5nUmVxKG5ldyBQcm90b0NvbmNlcHRNYW5hZ2VyLkdldFRoaW5nLlJlcSgpLnNldElpZChpaWQpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIGlmIChyZXMuZ2V0R2V0VGhpbmdSZXMoKS5nZXRSZXNDYXNlKCkgPT09IFByb3RvQ29uY2VwdE1hbmFnZXIuR2V0VGhpbmcuUmVzLlJlc0Nhc2UuVEhJTkcpXG4gICAgICAgICAgICByZXR1cm4gQ29uY2VwdFByb3RvUmVhZGVyLnRoaW5nKHJlcy5nZXRHZXRUaGluZ1JlcygpLmdldFRoaW5nKCkpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPFR5cGUgfCBudWxsPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBQcm90b0NvbmNlcHRNYW5hZ2VyLlJlcSgpXG4gICAgICAgICAgICAuc2V0R2V0VHlwZVJlcShuZXcgUHJvdG9Db25jZXB0TWFuYWdlci5HZXRUeXBlLlJlcSgpLnNldExhYmVsKGxhYmVsKSk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShyZXEpO1xuICAgICAgICBpZiAocmVzLmdldEdldFR5cGVSZXMoKS5nZXRSZXNDYXNlKCkgPT09IFByb3RvQ29uY2VwdE1hbmFnZXIuR2V0VHlwZS5SZXMuUmVzQ2FzZS5UWVBFKVxuICAgICAgICAgICAgcmV0dXJuIFR5cGVJbXBsLm9mKHJlcy5nZXRHZXRUeXBlUmVzKCkuZ2V0VHlwZSgpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0UnVsZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxSdWxlIHwgbnVsbD4ge1xuICAgICAgICBjb25zdCByZXEgPSBuZXcgUHJvdG9Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldEdldFJ1bGVSZXEobmV3IFByb3RvQ29uY2VwdE1hbmFnZXIuR2V0UnVsZS5SZXEoKS5zZXRMYWJlbChsYWJlbCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRHZXRSdWxlUmVzKCkuZ2V0UmVzQ2FzZSgpID09PSBQcm90b0NvbmNlcHRNYW5hZ2VyLkdldFJ1bGUuUmVzLlJlc0Nhc2UuUlVMRSkgcmV0dXJuIFJ1bGVJbXBsLm9mKHJlcy5nZXRHZXRSdWxlUmVzKCkuZ2V0UnVsZSgpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBleGVjdXRlKGNvbmNlcHRNYW5hZ2VyUmVxOiBQcm90b0NvbmNlcHRNYW5hZ2VyLlJlcSk6IFByb21pc2U8UHJvdG9Db25jZXB0TWFuYWdlci5SZXM+IHtcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25SZXEgPSBuZXcgVHJhbnNhY3Rpb25Qcm90by5UcmFuc2FjdGlvbi5SZXEoKVxuICAgICAgICAgICAgLnNldENvbmNlcHRNYW5hZ2VyUmVxKGNvbmNlcHRNYW5hZ2VyUmVxKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3JwY1RyYW5zYWN0aW9uLmV4ZWN1dGUodHJhbnNhY3Rpb25SZXEsIHJlcyA9PiByZXMuZ2V0Q29uY2VwdE1hbmFnZXJSZXMoKSk7XG4gICAgfVxufVxuIl19