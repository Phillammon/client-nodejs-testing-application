/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/ConceptManager", ["require", "exports", "grakn-client/dependencies_internal", "graknlabs-grpc-protocol/protobuf/concept_pb", "graknlabs-grpc-protocol/protobuf/transaction_pb"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ConceptManager = void 0;
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    const concept_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/concept_pb"));
    const transaction_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/transaction_pb"));
    class ConceptManager {
        constructor(rpcTransaction) {
            this._rpcTransaction = rpcTransaction;
        }
        getRootThingType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("thing");
            });
        }
        getRootEntityType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("entity");
            });
        }
        getRootRelationType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("relation");
            });
        }
        getRootAttributeType() {
            return __awaiter(this, void 0, void 0, function* () {
                return yield this.getType("attribute");
            });
        }
        putEntityType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutEntityTypeReq(new concept_pb_1.default.ConceptManager.PutEntityType.Req().setLabel(label));
                const res = yield this.execute(req);
                return dependencies_internal_1.EntityTypeImpl.of(res.getPutEntityTypeRes().getEntityType());
            });
        }
        getEntityType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const type = yield this.getType(label);
                if (type instanceof dependencies_internal_1.EntityTypeImpl)
                    return type;
                else
                    return null;
            });
        }
        putRelationType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutRelationTypeReq(new concept_pb_1.default.ConceptManager.PutRelationType.Req().setLabel(label));
                const res = yield this.execute(req);
                return dependencies_internal_1.RelationTypeImpl.of(res.getPutRelationTypeRes().getRelationType());
            });
        }
        getRelationType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const type = yield this.getType(label);
                if (type instanceof dependencies_internal_1.RelationTypeImpl)
                    return type;
                else
                    return null;
            });
        }
        putAttributeType(label, valueType) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutAttributeTypeReq(new concept_pb_1.default.ConceptManager.PutAttributeType.Req()
                    .setLabel(label)
                    .setValueType(dependencies_internal_1.ConceptProtoBuilder.valueType(valueType)));
                const res = yield this.execute(req);
                return dependencies_internal_1.ConceptProtoReader.attributeType(res.getPutAttributeTypeRes().getAttributeType());
            });
        }
        getAttributeType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const type = yield this.getType(label);
                if (type instanceof dependencies_internal_1.AttributeTypeImpl)
                    return type;
                else
                    return null;
            });
        }
        putRule(label, when, then) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setPutRuleReq(new concept_pb_1.default.ConceptManager.PutRule.Req()
                    .setLabel(label)
                    .setWhen(when)
                    .setThen(then));
                const res = yield this.execute(req);
                return dependencies_internal_1.RuleImpl.of(res.getPutRuleRes().getRule());
            });
        }
        getThing(iid) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setGetThingReq(new concept_pb_1.default.ConceptManager.GetThing.Req().setIid(iid));
                const res = yield this.execute(req);
                if (res.getGetThingRes().getResCase() === concept_pb_1.default.ConceptManager.GetThing.Res.ResCase.THING)
                    return dependencies_internal_1.ConceptProtoReader.thing(res.getGetThingRes().getThing());
                else
                    return null;
            });
        }
        getType(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setGetTypeReq(new concept_pb_1.default.ConceptManager.GetType.Req().setLabel(label));
                const res = yield this.execute(req);
                if (res.getGetTypeRes().getResCase() === concept_pb_1.default.ConceptManager.GetType.Res.ResCase.TYPE)
                    return dependencies_internal_1.ConceptProtoReader.type(res.getGetTypeRes().getType());
                else
                    return null;
            });
        }
        getRule(label) {
            return __awaiter(this, void 0, void 0, function* () {
                const req = new concept_pb_1.default.ConceptManager.Req()
                    .setGetRuleReq(new concept_pb_1.default.ConceptManager.GetRule.Req().setLabel(label));
                const res = yield this.execute(req);
                if (res.getGetRuleRes().getResCase() === concept_pb_1.default.ConceptManager.GetRule.Res.ResCase.RULE)
                    return dependencies_internal_1.RuleImpl.of(res.getGetRuleRes().getRule());
                return null;
            });
        }
        execute(conceptManagerReq) {
            return __awaiter(this, void 0, void 0, function* () {
                const transactionReq = new transaction_pb_1.default.Transaction.Req()
                    .setConceptManagerReq(conceptManagerReq);
                return yield this._rpcTransaction.execute(transactionReq, res => res.getConceptManagerRes());
            });
        }
    }
    exports.ConceptManager = ConceptManager;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29uY2VwdE1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb25jZXB0L0NvbmNlcHRNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUVILDhFQWVrQztJQUNsQyw2RkFBdUU7SUFDdkUscUdBQStFO0lBRS9FLE1BQWEsY0FBYztRQUd2QixZQUFhLGNBQThCO1lBQ3ZDLElBQUksQ0FBQyxlQUFlLEdBQUcsY0FBYyxDQUFDO1FBQzFDLENBQUM7UUFFSyxnQkFBZ0I7O2dCQUNsQixPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQWMsQ0FBQztZQUNwRCxDQUFDO1NBQUE7UUFFSyxpQkFBaUI7O2dCQUNuQixPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQWUsQ0FBQztZQUN0RCxDQUFDO1NBQUE7UUFFSyxtQkFBbUI7O2dCQUNyQixPQUFPLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQWlCLENBQUM7WUFDMUQsQ0FBQztTQUFBO1FBRUssb0JBQW9COztnQkFDdEIsT0FBTyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFrQixDQUFDO1lBQzVELENBQUM7U0FBQTtRQUVLLGFBQWEsQ0FBQyxLQUFhOztnQkFDN0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxvQkFBWSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUU7cUJBQzVDLG1CQUFtQixDQUFDLElBQUksb0JBQVksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUM5RixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BDLE9BQU8sc0NBQWMsQ0FBQyxFQUFFLENBQUMs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LEdBQUcsR0FBRyxJQUFJLG9CQUFZLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRTtxQkFDNUMsYUFBYSxDQUFDLElBQUksb0JBQVksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNsRixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BDLElBQUksR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDLFVBQVUsRUFBRSxLQUFLLG9CQUFZLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUk7b0JBQUUsT0FBTyxnQ0FBUSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztnQkFDakosT0FBTyxJQUFJLENBQUM7WUFDaEIsQ0FBQztTQUFBO1FBRWEsT0FBTyxDQUFDLGlCQUFrRDs7Z0JBQ3BFLE1BQU0sY0FBYyxHQUFHLElBQUksd0JBQWdCLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRTtxQkFDeEQsb0JBQW9CLENBQUMsaUJBQWlCLENBQUMsQ0FBQztnQkFDN0MsT0FBTyxNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUM7WUFDakcsQ0FBQztTQUFBO0tBQ0o7SUEzR0Qsd0NBMkdDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gICAgQ29uY2VwdFByb3RvQnVpbGRlcixcbiAgICBDb25jZXB0UHJvdG9SZWFkZXIsXG4gICAgVGhpbmdUeXBlLFxuICAgIEVudGl0eVR5cGUsXG4gICAgUmVsYXRpb25UeXBlLFxuICAgIEF0dHJpYnV0ZVR5cGUsXG4gICAgRW50aXR5VHlwZUltcGwsXG4gICAgVHlwZSxcbiAgICBSdWxlLFxuICAgIFJ1bGVJbXBsLFxuICAgIFJQQ1RyYW5zYWN0aW9uLFxuICAgIFJlbGF0aW9uVHlwZUltcGwsXG4gICAgQXR0cmlidXRlVHlwZUltcGwsXG4gICAgVGhpbmcsXG59IGZyb20gXCIuLi9kZXBlbmRlbmNpZXNfaW50ZXJuYWxcIjtcbmltcG9ydCBDb25jZXB0UHJvdG8gZnJvbSBcImdyYWtubGFicy1ncnBjLXByb3RvY29sL3Byb3RvYnVmL2NvbmNlcHRfcGJcIjtcbmltcG9ydCBUcmFuc2FjdGlvblByb3RvIGZyb20gXCJncmFrbmxhYnMtZ3JwYy1wcm90b2NvbC9wcm90b2J1Zi90cmFuc2FjdGlvbl9wYlwiO1xuXG5leHBvcnQgY2xhc3MgQ29uY2VwdE1hbmFnZXIge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3JwY1RyYW5zYWN0aW9uOiBSUENUcmFuc2FjdGlvbjtcblxuICAgIGNvbnN0cnVjdG9yIChycGNUcmFuc2FjdGlvbjogUlBDVHJhbnNhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5fcnBjVHJhbnNhY3Rpb24gPSBycGNUcmFuc2FjdGlvbjtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRSb290VGhpbmdUeXBlKCk6IFByb21pc2U8VGhpbmdUeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJ0aGluZ1wiKSBhcyBUaGluZ1R5cGU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Um9vdEVudGl0eVR5cGUoKTogUHJvbWlzZTxFbnRpdHlUeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJlbnRpdHlcIikgYXMgRW50aXR5VHlwZTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRSb290UmVsYXRpb25UeXBlKCk6IFByb21pc2U8UmVsYXRpb25UeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJyZWxhdGlvblwiKSBhcyBSZWxhdGlvblR5cGU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Um9vdEF0dHJpYnV0ZVR5cGUoKTogUHJvbWlzZTxBdHRyaWJ1dGVUeXBlPiB7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFR5cGUoXCJhdHRyaWJ1dGVcIikgYXMgQXR0cmlidXRlVHlwZTtcbiAgICB9XG5cbiAgICBhc3luYyBwdXRFbnRpdHlUeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPEVudGl0eVR5cGU+IHtcbiAgICAgICAgY29uc3QgcmVxID0gbmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldFB1dEVudGl0eVR5cGVSZXEobmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5QdXRFbnRpdHlUeXBlLlJlcSgpLnNldExhYmVsKGxhYmVsKSk7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShyZXEpO1xuICAgICAgICByZXR1cm4gRW50aXR5VHlwZUltcGwub2YocmVzLmdldFB1dEVudGl0eVR5cGVSZXMoKS5nZXRFbnRpdHlUeXBlKCkpO1xuICAgIH1cblxuICAgIGFzeW5jIGdldEVudGl0eVR5cGUobGFiZWw6IHN0cmluZyk6IFByb21pc2U8RW50aXR5VHlwZT4ge1xuICAgICAgICBjb25zdCB0eXBlID0gYXdhaXQgdGhpcy5nZXRUeXBlKGxhYmVsKTtcbiAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBFbnRpdHlUeXBlSW1wbCkgcmV0dXJuIHR5cGUgYXMgRW50aXR5VHlwZTtcbiAgICAgICAgZWxzZSByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBhc3luYyBwdXRSZWxhdGlvblR5cGUobGFiZWw6IHN0cmluZyk6IFByb21pc2U8UmVsYXRpb25UeXBlPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRQdXRSZWxhdGlvblR5cGVSZXEobmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5QdXRSZWxhdGlvblR5cGUuUmVxKCkuc2V0TGFiZWwobGFiZWwpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIHJldHVybiBSZWxhdGlvblR5cGVJbXBsLm9mKHJlcy5nZXRQdXRSZWxhdGlvblR5cGVSZXMoKS5nZXRSZWxhdGlvblR5cGUoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0UmVsYXRpb25UeXBlKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPFJlbGF0aW9uVHlwZT4ge1xuICAgICAgICBjb25zdCB0eXBlID0gYXdhaXQgdGhpcy5nZXRUeXBlKGxhYmVsKTtcbiAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBSZWxhdGlvblR5cGVJbXBsKSByZXR1cm4gdHlwZSBhcyBSZWxhdGlvblR5cGU7XG4gICAgICAgIGVsc2UgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgcHV0QXR0cmlidXRlVHlwZShsYWJlbDogc3RyaW5nLCB2YWx1ZVR5cGU6IEF0dHJpYnV0ZVR5cGUuVmFsdWVUeXBlKTogUHJvbWlzZTxBdHRyaWJ1dGVUeXBlPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRQdXRBdHRyaWJ1dGVUeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUHV0QXR0cmlidXRlVHlwZS5SZXEoKVxuICAgICAgICAgICAgICAgIC5zZXRMYWJlbChsYWJlbClcbiAgICAgICAgICAgICAgICAuc2V0VmFsdWVUeXBlKENvbmNlcHRQcm90b0J1aWxkZXIudmFsdWVUeXBlKHZhbHVlVHlwZSkpKTtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKHJlcSk7XG4gICAgICAgIHJldHVybiBDb25jZXB0UHJvdG9SZWFkZXIuYXR0cmlidXRlVHlwZShyZXMuZ2V0UHV0QXR0cmlidXRlVHlwZVJlcygpLmdldEF0dHJpYnV0ZVR5cGUoKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0QXR0cmlidXRlVHlwZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxBdHRyaWJ1dGVUeXBlPiB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSBhd2FpdCB0aGlzLmdldFR5cGUobGFiZWwpO1xuICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIEF0dHJpYnV0ZVR5cGVJbXBsKSByZXR1cm4gdHlwZSBhcyBBdHRyaWJ1dGVUeXBlO1xuICAgICAgICBlbHNlIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGFzeW5jIHB1dFJ1bGUobGFiZWw6IHN0cmluZywgd2hlbjogc3RyaW5nLCB0aGVuOiBzdHJpbmcpOiBQcm9taXNlPFJ1bGU+IHtcbiAgICAgICAgY29uc3QgcmVxID0gbmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldFB1dFJ1bGVSZXEobmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5QdXRSdWxlLlJlcSgpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRMYWJlbChsYWJlbClcbiAgICAgICAgICAgICAgICAgICAgLnNldFdoZW4od2hlbilcbiAgICAgICAgICAgICAgICAgICAgLnNldFRoZW4odGhlbikpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgcmV0dXJuIFJ1bGVJbXBsLm9mKHJlcy5nZXRQdXRSdWxlUmVzKCkuZ2V0UnVsZSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUaGluZyhpaWQ6IHN0cmluZyk6IFByb21pc2U8VGhpbmc+IHtcbiAgICAgICAgY29uc3QgcmVxID0gbmV3IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5SZXEoKVxuICAgICAgICAgICAgLnNldEdldFRoaW5nUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0VGhpbmcuUmVxKCkuc2V0SWlkKGlpZCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRHZXRUaGluZ1JlcygpLmdldFJlc0Nhc2UoKSA9PT0gQ29uY2VwdFByb3RvLkNvbmNlcHRNYW5hZ2VyLkdldFRoaW5nLlJlcy5SZXNDYXNlLlRISU5HKVxuICAgICAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90b1JlYWRlci50aGluZyhyZXMuZ2V0R2V0VGhpbmdSZXMoKS5nZXRUaGluZygpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VHlwZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxUeXBlPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRHZXRUeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0VHlwZS5SZXEoKS5zZXRMYWJlbChsYWJlbCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRHZXRUeXBlUmVzKCkuZ2V0UmVzQ2FzZSgpID09PSBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0VHlwZS5SZXMuUmVzQ2FzZS5UWVBFKVxuICAgICAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90b1JlYWRlci50eXBlKHJlcy5nZXRHZXRUeXBlUmVzKCkuZ2V0VHlwZSgpKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0UnVsZShsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxSdWxlPiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuUmVxKClcbiAgICAgICAgICAgIC5zZXRHZXRSdWxlUmVxKG5ldyBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0UnVsZS5SZXEoKS5zZXRMYWJlbChsYWJlbCkpO1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUocmVxKTtcbiAgICAgICAgaWYgKHJlcy5nZXRHZXRSdWxlUmVzKCkuZ2V0UmVzQ2FzZSgpID09PSBDb25jZXB0UHJvdG8uQ29uY2VwdE1hbmFnZXIuR2V0UnVsZS5SZXMuUmVzQ2FzZS5SVUxFKSByZXR1cm4gUnVsZUltcGwub2YocmVzLmdldEdldFJ1bGVSZXMoKS5nZXRSdWxlKCkpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGV4ZWN1dGUoY29uY2VwdE1hbmFnZXJSZXE6IENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5SZXEpOiBQcm9taXNlPENvbmNlcHRQcm90by5Db25jZXB0TWFuYWdlci5SZXM+IHtcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25SZXEgPSBuZXcgVHJhbnNhY3Rpb25Qcm90by5UcmFuc2FjdGlvbi5SZXEoKVxuICAgICAgICAgICAgLnNldENvbmNlcHRNYW5hZ2VyUmVxKGNvbmNlcHRNYW5hZ2VyUmVxKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3JwY1RyYW5zYWN0aW9uLmV4ZWN1dGUodHJhbnNhY3Rpb25SZXEsIHJlcyA9PiByZXMuZ2V0Q29uY2VwdE1hbmFnZXJSZXMoKSk7XG4gICAgfVxufVxuIl19