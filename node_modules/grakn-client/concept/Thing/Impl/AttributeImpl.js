/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/thing/impl/AttributeImpl", ["require", "exports", "grakn-client/dependencies_internal", "graknlabs-grpc-protocol/protobuf/concept_pb"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.DateTimeAttributeImpl = exports.RemoteStringAttributeImpl = exports.StringAttributeImpl = exports.RemoteDoubleAttributeImpl = exports.DoubleAttributeImpl = exports.RemoteLongAttributeImpl = exports.LongAttributeImpl = exports.RemoteBooleanAttributeImpl = exports.BooleanAttributeImpl = exports.RemoteAttributeImpl = exports.AttributeImpl = void 0;
    const dependencies_internal_1 = require("grakn-client/dependencies_internal");
    const concept_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/concept_pb"));
    class AttributeImpl extends dependencies_internal_1.ThingImpl {
        constructor(iid) {
            super(iid);
        }
    }
    exports.AttributeImpl = AttributeImpl;
    class RemoteAttributeImpl extends dependencies_internal_1.RemoteThingImpl {
        constructor(transaction, iid) {
            super(transaction, iid);
        }
        getOwners(ownerType) {
            const method = new concept_pb_1.default.Thing.Req().setAttributeGetOwnersReq(new concept_pb_1.default.Attribute.GetOwners.Req().setThingType(dependencies_internal_1.ConceptProtoBuilder.type(ownerType)));
            return this.thingStream(method, res => res.getAttributeGetOwnersRes().getThingList());
        }
        getType() {
            return __awaiter(this, void 0, void 0, function* () {
                const res = yield this.execute(new concept_pb_1.default.Thing.Req().setThingGetTypeReq(new concept_pb_1.default.Thing.GetType.Req()));
                return dependencies_internal_1.ConceptProtoReader.thingType(res.getThingGetTypeRes().getThingType());
            });
        }
    }
    exports.RemoteAttributeImpl = RemoteAttributeImpl;
    class BooleanAttributeImpl extends AttributeImpl {
        constructor(iid, value) {
            super(iid);
            this._value = value;
        }
        static of(protoThing) {
            return new BooleanAttributeImpl(protoThing.getIid_asB64(), protoThing.getValue().getBoolean());
        }
        asRemote(transaction) {
            return new RemoteBooleanAttributeImpl(transaction, this.getIID(), this._value);
        }
        getValue() {
            return this._value;
        }
    }
    exports.BooleanAttributeImpl = BooleanAttributeImpl;
    class RemoteBooleanAttributeImpl extends RemoteAttributeImpl {
        constructor(transaction, iid, value) {
            super(transaction, iid);
            this._value = value;
        }
        getValue() {
            return this._value;
        }
        getType() {
            return __awaiter(this, void 0, void 0, function* () {
                const res = yield this.execute(new concept_pb_1.default.Thing.Req().setThingGetTypeReq(new concept_pb_1.default.Thing.GetType.Req()));
                return dependencies_internal_1.BooleanAttributeTypeImpl.of(res.getThingGetTypeRes().getThingType());
            });
        }
        asRemote(transaction) {
            return new RemoteBooleanAttributeImpl(transaction, this.getIID(), this._value);
        }
    }
    exports.RemoteBooleanAttributeImpl = RemoteBooleanAttributeImpl;
    class LongAttributeImpl extends AttributeImpl {
        constructor(iid, value) {
            super(iid);
            this._value = value;
        }
        static of(protoThing) {
            return new LongAttributeImpl(protoThing.getIid_asB64(), protoThing.getValue().getLong());
        }
        asRemote(transaction) {
            return new RemoteLongAttributeImpl(transaction, this.getIID(), this._value);
        }
        getValue() {
            return this._value;
        }
    }
    exports.LongAttributeImpl = LongAttributeImpl;
    class RemoteLongAttributeImpl extends RemoteAttributeImpl {
        constructor(transaction, iid, value) {
            super(transaction, iid);
            this._value = value;
        }
        getValue() {
            return this._value;
        }
        getType() {
            return __awaiter(this, void 0, void 0, function* () {
                const res = yield this.execute(new concept_pb_1.default.Thing.Req().setThingGetTypeReq(new concept_pb_1.default.Thing.GetType.Req()));
                return dependencies_internal_1.LongAttributeTypeImpl.of(res.getThingGetTypeRes().getThingType());
            });
        }
        asRemote(transaction) {
            return new RemoteLongAttributeImpl(transaction, this.getIID(), this._value);
        }
    }
    exports.RemoteLongAttributeImpl = RemoteLongAttributeImpl;
    class DoubleAttributeImpl extends AttributeImpl {
        constructor(iid, value) {
            super(iid);
            this._value = value;
        }
        static of(protoThing) {
            return new DoubleAttributeImpl(protoThing.getIid_asB64(), protoThing.getValue().getDouble());
        }
        asRemote(transaction) {
            return new RemoteDoubleAttributeImpl(transaction, this.getIID(), this._value);
        }
        getValue() {
            return this._value;
        }
    }
    exports.DoubleAttributeImpl = DoubleAttributeImpl;
    class RemoteDoubleAttributeImpl extends RemoteAttributeImpl {
        constructor(transaction, iid, value) {
            super(transaction, iid);
            this._value = value;
        }
        getValue() {
            return this._value;
        }
        getType() {
            return __awaiter(this, void 0, void 0, function* () {
                const res = yield this.execute(new concept_pb_1.default.Thing.Req().setThingGetTypeReq(new concept_pb_1.default.Thing.GetType.Req()));
                return dependencies_internal_1.DoubleAttributeTypeImpl.of(res.getThingGetTypeRes().getThingType());
            });
        }
        asRemote(transaction) {
            return new RemoteDoubleAttributeImpl(transaction, this.getIID(), this._value);
        }
    }
    exports.RemoteDoubleAttributeImpl = RemoteDoubleAttributeImpl;
    class StringAttributeImpl extends AttributeImpl {
        constructor(iid, value) {
            super(iid);
            this._value = value;
        }
        static of(protoThing) {
            return new StringAttributeImpl(protoThing.getIid_asB64(), protoThing.getValue().getString());
        }
        asRemote(transaction) {
            return new RemoteStringAttributeImpl(transaction, this.getIID(), this._value);
        }
        getValue() {
            return this._value;
        }
    }
    exports.StringAttributeImpl = StringAttributeImpl;
    class RemoteStringAttributeImpl extends RemoteAttributeImpl {
        constructor(transaction, iid, value) {
            super(transaction, iid);
            this._value = value;
        }
        getValue() {
            return this._value;
        }
        getType() {
            return __awaiter(this, void 0, void 0, function* () {
                const res = yield this.execute(new concept_pb_1.default.Thing.Req().setThingGetTypeReq(new concept_pb_1.default.Thing.GetType.Req()));
                return dependencies_internal_1.StringAttributeTypeImpl.of(res.getThingGetTypeRes().getThingType());
            });
        }
        asRemote(transaction) {
            return new RemoteStringAttributeImpl(transaction, this.getIID(), this._value);
        }
    }
    exports.RemoteStringAttributeImpl = RemoteStringAttributeImpl;
    class DateTimeAttributeImpl extends AttributeImpl {
        constructor(iid, value) {
            super(iid);
            this._value = value;
        }
        static of(protoThing) {
            return new DateTimeAttributeImpl(protoThing.getIid_asB64(), new Date(protoThing.getValue().getDateTime()));
        }
        asRemote(transaction) {
            return new RemoteDateTimeAttributeImpl(transaction, this.getIID(), this._value);
        }
        getValue() {
            return this._value;
        }
    }
    exports.DateTimeAttributeImpl = DateTimeAttributeImpl;
    class RemoteDateTimeAttributeImpl extends RemoteAttributeImpl {
        constructor(transaction, iid, value) {
            super(transaction, iid);
            this._value = value;
        }
        getValue() {
            return this._value;
        }
        getType() {
            return __awaiter(this, void 0, void 0, function* () {
                const res = yield this.execute(new concept_pb_1.default.Thing.Req().setThingGetTypeReq(new concept_pb_1.default.Thing.GetType.Req()));
                return dependencies_internal_1.DateTimeAttributeTypeImpl.of(res.getThingGetTypeRes().getThingType());
            });
        }
        asRemote(transaction) {
            return new RemoteDateTimeAttributeImpl(transaction, this.getIID(), this._value);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXR0cmlidXRlSW1wbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2NvbmNlcHQvdGhpbmcvaW1wbC9BdHRyaWJ1dGVJbXBsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUVILDhFQTBCd0M7SUFHeEMsNkZBQXVFO0lBRXZFLE1BQXNCLGFBQW9DLFNBQVEsaUNBQVM7UUFDdkUsWUFBc0IsR0FBVztZQUM3QixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDZixDQUFDO0tBS0o7SUFSRCxzQ0FRQztJQUVELE1BQXNCLG1CQUEwQyxTQUFRLHVDQUFlO1FBQ25GLFlBQXNCLFdBQXdCLEVBQUUsR0FBVztZQUN2RCxLQUFLLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLENBQUM7UUFFRCxTQUFTLENBQUMsU0FBb0I7WUFDMUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxvQkFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyx3QkFBd0IsQ0FDaEUsSUFBSSxvQkFBWSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLDJDQUFtQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUMvRixDQUFDO1lBQ0YsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFzQixDQUFDO1FBQy9HLENBQUM7UUFFSyxPQUFPOztnQkFDVCxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxvQkFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLG9CQUFZLENBQUMsS0FBSyxDQUFDLE9BQU8s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QXdCO1lBQzdCLE9BQU8sSUFBSSwyQkFBMkIsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwRixDQUFDO0tBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBBdHRyaWJ1dGUsXG4gICAgUmVtb3RlQXR0cmlidXRlLFxuICAgIEJvb2xlYW5BdHRyaWJ1dGUsXG4gICAgRGF0ZVRpbWVBdHRyaWJ1dGUsXG4gICAgRG91YmxlQXR0cmlidXRlLFxuICAgIExvbmdBdHRyaWJ1dGUsXG4gICAgU3RyaW5nQXR0cmlidXRlLFxuICAgIFJlbW90ZUJvb2xlYW5BdHRyaWJ1dGUsXG4gICAgUmVtb3RlTG9uZ0F0dHJpYnV0ZSxcbiAgICBSZW1vdGVTdHJpbmdBdHRyaWJ1dGUsXG4gICAgUmVtb3RlRG91YmxlQXR0cmlidXRlLFxuICAgIFJlbW90ZURhdGVUaW1lQXR0cmlidXRlLFxuICAgIFRoaW5nSW1wbCxcbiAgICBSZW1vdGVUaGluZ0ltcGwsXG4gICAgVGhpbmdUeXBlLFxuICAgIEF0dHJpYnV0ZVR5cGVJbXBsLFxuICAgIEJvb2xlYW5BdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBEYXRlVGltZUF0dHJpYnV0ZVR5cGVJbXBsLFxuICAgIERvdWJsZUF0dHJpYnV0ZVR5cGVJbXBsLFxuICAgIExvbmdBdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBTdHJpbmdBdHRyaWJ1dGVUeXBlSW1wbCxcbiAgICBBdHRyaWJ1dGVUeXBlLFxuICAgIEdyYWtuLFxuICAgIE1lcmdlLFxuICAgIFN0cmVhbSwgQ29uY2VwdFByb3RvQnVpbGRlciwgQ29uY2VwdFByb3RvUmVhZGVyLFxufSBmcm9tIFwiLi4vLi4vLi4vZGVwZW5kZW5jaWVzX2ludGVybmFsXCI7XG5pbXBvcnQgVmFsdWVDbGFzcyA9IEF0dHJpYnV0ZVR5cGUuVmFsdWVDbGFzcztcbmltcG9ydCBUcmFuc2FjdGlvbiA9IEdyYWtuLlRyYW5zYWN0aW9uO1xuaW1wb3J0IENvbmNlcHRQcm90byBmcm9tIFwiZ3Jha25sYWJzLWdycGMtcHJvdG9jb2wvcHJvdG9idWYvY29uY2VwdF9wYlwiO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQXR0cmlidXRlSW1wbDxUIGV4dGVuZHMgVmFsdWVDbGFzcz4gZXh0ZW5kcyBUaGluZ0ltcGwgaW1wbGVtZW50cyBBdHRyaWJ1dGU8VD4ge1xuICAgIHByb3RlY3RlZCBjb25zdHJ1Y3RvcihpaWQ6IHN0cmluZykge1xuICAgICAgICBzdXBlcihpaWQpO1xuICAgIH1cblxuICAgIGFic3RyYWN0IGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZUF0dHJpYnV0ZTxUPjtcblxuICAgIGFic3RyYWN0IGdldFZhbHVlKCk6IFQ7XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBSZW1vdGVBdHRyaWJ1dGVJbXBsPFQgZXh0ZW5kcyBWYWx1ZUNsYXNzPiBleHRlbmRzIFJlbW90ZVRoaW5nSW1wbCBpbXBsZW1lbnRzIFJlbW90ZUF0dHJpYnV0ZTxUPiB7XG4gICAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbiwgaWlkOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIodHJhbnNhY3Rpb24sIGlpZCk7XG4gICAgfVxuXG4gICAgZ2V0T3duZXJzKG93bmVyVHlwZTogVGhpbmdUeXBlKTogU3RyZWFtPFRoaW5nSW1wbD4ge1xuICAgICAgICBjb25zdCBtZXRob2QgPSBuZXcgQ29uY2VwdFByb3RvLlRoaW5nLlJlcSgpLnNldEF0dHJpYnV0ZUdldE93bmVyc1JlcShcbiAgICAgICAgICAgIG5ldyBDb25jZXB0UHJvdG8uQXR0cmlidXRlLkdldE93bmVycy5SZXEoKS5zZXRUaGluZ1R5cGUoQ29uY2VwdFByb3RvQnVpbGRlci50eXBlKG93bmVyVHlwZSkpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB0aGlzLnRoaW5nU3RyZWFtKG1ldGhvZCwgcmVzID0+IHJlcy5nZXRBdHRyaWJ1dGVHZXRPd25lcnNSZXMoKS5nZXRUaGluZ0xpc3QoKSkgYXMgU3RyZWFtPFRoaW5nSW1wbD47XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VHlwZSgpOiBQcm9taXNlPEF0dHJpYnV0ZVR5cGVJbXBsPiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShuZXcgQ29uY2VwdFByb3RvLlRoaW5nLlJlcSgpLnNldFRoaW5nR2V0VHlwZVJlcShuZXcgQ29uY2VwdFByb3RvLlRoaW5nLkdldFR5cGUuUmVxKCkpKTtcbiAgICAgICAgcmV0dXJuIENvbmNlcHRQcm90b1JlYWRlci50aGluZ1R5cGUocmVzLmdldFRoaW5nR2V0VHlwZVJlcygpLmdldFRoaW5nVHlwZSgpKSBhcyBBdHRyaWJ1dGVUeXBlSW1wbDtcbiAgICB9XG5cbiAgICBhYnN0cmFjdCBhc1JlbW90ZSh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pOiBSZW1vdGVBdHRyaWJ1dGU8VD47XG5cbiAgICBhYnN0cmFjdCBnZXRWYWx1ZSgpOiBUO1xufVxuXG5leHBvcnQgY2xhc3MgQm9vbGVhbkF0dHJpYnV0ZUltcGwgZXh0ZW5kcyBBdHRyaWJ1dGVJbXBsPGJvb2xlYW4+IGltcGxlbWVudHMgQm9vbGVhbkF0dHJpYnV0ZSB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfdmFsdWU6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcihpaWQ6IHN0cmluZywgdmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgc3VwZXIoaWlkKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgb2YocHJvdG9UaGluZzogQ29uY2VwdFByb3RvLlRoaW5nKTogQm9vbGVhbkF0dHJpYnV0ZUltcGwge1xuICAgICAgICByZXR1cm4gbmV3IEJvb2xlYW5BdHRyaWJ1dGVJbXBsKHByb3RvVGhpbmcuZ2V0SWlkX2FzQjY0KCksIHByb3RvVGhpbmcuZ2V0VmFsdWUoKS5nZXRCb29sZWFuKCkpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZUJvb2xlYW5BdHRyaWJ1dGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVCb29sZWFuQXR0cmlidXRlSW1wbCh0cmFuc2FjdGlvbiwgdGhpcy5nZXRJSUQoKSwgdGhpcy5fdmFsdWUpO1xuICAgIH1cblxuICAgIGdldFZhbHVlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgUmVtb3RlQm9vbGVhbkF0dHJpYnV0ZUltcGwgZXh0ZW5kcyBSZW1vdGVBdHRyaWJ1dGVJbXBsPGJvb2xlYW4+IGltcGxlbWVudHMgTWVyZ2U8UmVtb3RlQm9vbGVhbkF0dHJpYnV0ZSwgQm9vbGVhbkF0dHJpYnV0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3ZhbHVlOiBib29sZWFuO1xuXG4gICAgY29uc3RydWN0b3IodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uLCBpaWQ6IHN0cmluZywgdmFsdWU6IGJvb2xlYW4pe1xuICAgICAgICBzdXBlcih0cmFuc2FjdGlvbiwgaWlkKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXRWYWx1ZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFR5cGUoKTogUHJvbWlzZTxCb29sZWFuQXR0cmlidXRlVHlwZUltcGw+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKG5ldyBDb25jZXB0UHJvdG8uVGhpbmcuUmVxKCkuc2V0VGhpbmdHZXRUeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uVGhpbmcuR2V0VHlwZS5SZXEoKSkpO1xuICAgICAgICByZXR1cm4gQm9vbGVhbkF0dHJpYnV0ZVR5cGVJbXBsLm9mKHJlcy5nZXRUaGluZ0dldFR5cGVSZXMoKS5nZXRUaGluZ1R5cGUoKSk7XG4gICAgfVxuXG4gICAgYXNSZW1vdGUodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uKTogUmVtb3RlQm9vbGVhbkF0dHJpYnV0ZUltcGwge1xuICAgICAgICByZXR1cm4gbmV3IFJlbW90ZUJvb2xlYW5BdHRyaWJ1dGVJbXBsKHRyYW5zYWN0aW9uLCB0aGlzLmdldElJRCgpLCB0aGlzLl92YWx1ZSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTG9uZ0F0dHJpYnV0ZUltcGwgZXh0ZW5kcyBBdHRyaWJ1dGVJbXBsPG51bWJlcj4gaW1wbGVtZW50cyBMb25nQXR0cmlidXRlIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF92YWx1ZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoaWlkOiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIoaWlkKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgb2YocHJvdG9UaGluZzogQ29uY2VwdFByb3RvLlRoaW5nKTogTG9uZ0F0dHJpYnV0ZUltcGwge1xuICAgICAgICByZXR1cm4gbmV3IExvbmdBdHRyaWJ1dGVJbXBsKHByb3RvVGhpbmcuZ2V0SWlkX2FzQjY0KCksIHByb3RvVGhpbmcuZ2V0VmFsdWUoKS5nZXRMb25nKCkpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZUxvbmdBdHRyaWJ1dGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVMb25nQXR0cmlidXRlSW1wbCh0cmFuc2FjdGlvbiwgdGhpcy5nZXRJSUQoKSwgdGhpcy5fdmFsdWUpO1xuICAgIH1cblxuICAgIGdldFZhbHVlKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSZW1vdGVMb25nQXR0cmlidXRlSW1wbCBleHRlbmRzIFJlbW90ZUF0dHJpYnV0ZUltcGw8bnVtYmVyPiBpbXBsZW1lbnRzIE1lcmdlPFJlbW90ZUxvbmdBdHRyaWJ1dGUsIExvbmdBdHRyaWJ1dGU+IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IF92YWx1ZTogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uLCBpaWQ6IHN0cmluZywgdmFsdWU6IG51bWJlcil7XG4gICAgICAgIHN1cGVyKHRyYW5zYWN0aW9uLCBpaWQpO1xuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldFZhbHVlKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXRUeXBlKCk6IFByb21pc2U8TG9uZ0F0dHJpYnV0ZVR5cGVJbXBsPiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShuZXcgQ29uY2VwdFByb3RvLlRoaW5nLlJlcSgpLnNldFRoaW5nR2V0VHlwZVJlcShuZXcgQ29uY2VwdFByb3RvLlRoaW5nLkdldFR5cGUuUmVxKCkpKTtcbiAgICAgICAgcmV0dXJuIExvbmdBdHRyaWJ1dGVUeXBlSW1wbC5vZihyZXMuZ2V0VGhpbmdHZXRUeXBlUmVzKCkuZ2V0VGhpbmdUeXBlKCkpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZUxvbmdBdHRyaWJ1dGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVMb25nQXR0cmlidXRlSW1wbCh0cmFuc2FjdGlvbiwgdGhpcy5nZXRJSUQoKSwgdGhpcy5fdmFsdWUpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIERvdWJsZUF0dHJpYnV0ZUltcGwgZXh0ZW5kcyBBdHRyaWJ1dGVJbXBsPG51bWJlcj4gaW1wbGVtZW50cyBBdHRyaWJ1dGU8bnVtYmVyPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfdmFsdWU6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKGlpZDogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKGlpZCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgc3RhdGljIG9mKHByb3RvVGhpbmc6IENvbmNlcHRQcm90by5UaGluZyk6IERvdWJsZUF0dHJpYnV0ZUltcGwge1xuICAgICAgICByZXR1cm4gbmV3IERvdWJsZUF0dHJpYnV0ZUltcGwocHJvdG9UaGluZy5nZXRJaWRfYXNCNjQoKSwgcHJvdG9UaGluZy5nZXRWYWx1ZSgpLmdldERvdWJsZSgpKTtcbiAgICB9XG5cbiAgICBhc1JlbW90ZSh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pOiBSZW1vdGVEb3VibGVBdHRyaWJ1dGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVEb3VibGVBdHRyaWJ1dGVJbXBsKHRyYW5zYWN0aW9uLCB0aGlzLmdldElJRCgpLCB0aGlzLl92YWx1ZSk7XG4gICAgfVxuXG4gICAgZ2V0VmFsdWUoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgIH1cbn1cblxuXG5leHBvcnQgY2xhc3MgUmVtb3RlRG91YmxlQXR0cmlidXRlSW1wbCBleHRlbmRzIFJlbW90ZUF0dHJpYnV0ZUltcGw8bnVtYmVyPiBpbXBsZW1lbnRzIE1lcmdlPFJlbW90ZURvdWJsZUF0dHJpYnV0ZSwgRG91YmxlQXR0cmlidXRlPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfdmFsdWU6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbiwgaWlkOiBzdHJpbmcsIHZhbHVlOiBudW1iZXIpe1xuICAgICAgICBzdXBlcih0cmFuc2FjdGlvbiwgaWlkKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXRWYWx1ZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VHlwZSgpOiBQcm9taXNlPERvdWJsZUF0dHJpYnV0ZVR5cGVJbXBsPiB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuZXhlY3V0ZShuZXcgQ29uY2VwdFByb3RvLlRoaW5nLlJlcSgpLnNldFRoaW5nR2V0VHlwZVJlcShuZXcgQ29uY2VwdFByb3RvLlRoaW5nLkdldFR5cGUuUmVxKCkpKTtcbiAgICAgICAgcmV0dXJuIERvdWJsZUF0dHJpYnV0ZVR5cGVJbXBsLm9mKHJlcy5nZXRUaGluZ0dldFR5cGVSZXMoKS5nZXRUaGluZ1R5cGUoKSk7XG4gICAgfVxuXG4gICAgYXNSZW1vdGUodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uKTogUmVtb3RlRG91YmxlQXR0cmlidXRlSW1wbCB7XG4gICAgICAgIHJldHVybiBuZXcgUmVtb3RlRG91YmxlQXR0cmlidXRlSW1wbCh0cmFuc2FjdGlvbiwgdGhpcy5nZXRJSUQoKSwgdGhpcy5fdmFsdWUpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFN0cmluZ0F0dHJpYnV0ZUltcGwgZXh0ZW5kcyBBdHRyaWJ1dGVJbXBsPHN0cmluZz4gaW1wbGVtZW50cyBBdHRyaWJ1dGU8c3RyaW5nPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfdmFsdWU6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKGlpZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKGlpZCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgc3RhdGljIG9mKHByb3RvVGhpbmc6IENvbmNlcHRQcm90by5UaGluZyk6IFN0cmluZ0F0dHJpYnV0ZUltcGwge1xuICAgICAgICByZXR1cm4gbmV3IFN0cmluZ0F0dHJpYnV0ZUltcGwocHJvdG9UaGluZy5nZXRJaWRfYXNCNjQoKSwgcHJvdG9UaGluZy5nZXRWYWx1ZSgpLmdldFN0cmluZygpKTtcbiAgICB9XG5cbiAgICBhc1JlbW90ZSh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pOiBSZW1vdGVTdHJpbmdBdHRyaWJ1dGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVTdHJpbmdBdHRyaWJ1dGVJbXBsKHRyYW5zYWN0aW9uLCB0aGlzLmdldElJRCgpLCB0aGlzLl92YWx1ZSk7XG4gICAgfVxuXG4gICAgZ2V0VmFsdWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFJlbW90ZVN0cmluZ0F0dHJpYnV0ZUltcGwgZXh0ZW5kcyBSZW1vdGVBdHRyaWJ1dGVJbXBsPHN0cmluZz4gaW1wbGVtZW50cyBNZXJnZTxSZW1vdGVTdHJpbmdBdHRyaWJ1dGUsIFN0cmluZ0F0dHJpYnV0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3ZhbHVlOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcih0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24sIGlpZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKXtcbiAgICAgICAgc3VwZXIodHJhbnNhY3Rpb24sIGlpZCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0VmFsdWUoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgIH1cblxuICAgIGFzeW5jIGdldFR5cGUoKTogUHJvbWlzZTxTdHJpbmdBdHRyaWJ1dGVUeXBlSW1wbD4ge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLmV4ZWN1dGUobmV3IENvbmNlcHRQcm90by5UaGluZy5SZXEoKS5zZXRUaGluZ0dldFR5cGVSZXEobmV3IENvbmNlcHRQcm90by5UaGluZy5HZXRUeXBlLlJlcSgpKSk7XG4gICAgICAgIHJldHVybiBTdHJpbmdBdHRyaWJ1dGVUeXBlSW1wbC5vZihyZXMuZ2V0VGhpbmdHZXRUeXBlUmVzKCkuZ2V0VGhpbmdUeXBlKCkpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZVN0cmluZ0F0dHJpYnV0ZUltcGwge1xuICAgICAgICByZXR1cm4gbmV3IFJlbW90ZVN0cmluZ0F0dHJpYnV0ZUltcGwodHJhbnNhY3Rpb24sIHRoaXMuZ2V0SUlEKCksIHRoaXMuX3ZhbHVlKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEYXRlVGltZUF0dHJpYnV0ZUltcGwgZXh0ZW5kcyBBdHRyaWJ1dGVJbXBsPERhdGU+IGltcGxlbWVudHMgRGF0ZVRpbWVBdHRyaWJ1dGUge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3ZhbHVlOiBEYXRlO1xuXG4gICAgY29uc3RydWN0b3IoaWlkOiBzdHJpbmcsIHZhbHVlOiBEYXRlKSB7XG4gICAgICAgIHN1cGVyKGlpZCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgc3RhdGljIG9mKHByb3RvVGhpbmc6IENvbmNlcHRQcm90by5UaGluZyk6IERhdGVUaW1lQXR0cmlidXRlSW1wbCB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZVRpbWVBdHRyaWJ1dGVJbXBsKHByb3RvVGhpbmcuZ2V0SWlkX2FzQjY0KCksIG5ldyBEYXRlKHByb3RvVGhpbmcuZ2V0VmFsdWUoKS5nZXREYXRlVGltZSgpKSk7XG4gICAgfVxuXG4gICAgYXNSZW1vdGUodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uKTogUmVtb3RlRGF0ZVRpbWVBdHRyaWJ1dGVJbXBsIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdGVEYXRlVGltZUF0dHJpYnV0ZUltcGwodHJhbnNhY3Rpb24sIHRoaXMuZ2V0SUlEKCksIHRoaXMuX3ZhbHVlKTtcbiAgICB9XG5cbiAgICBnZXRWYWx1ZSgpOiBEYXRlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgIH1cbn1cblxuXG5jbGFzcyBSZW1vdGVEYXRlVGltZUF0dHJpYnV0ZUltcGwgZXh0ZW5kcyBSZW1vdGVBdHRyaWJ1dGVJbXBsPERhdGU+IGltcGxlbWVudHMgTWVyZ2U8UmVtb3RlRGF0ZVRpbWVBdHRyaWJ1dGUsIERhdGVUaW1lQXR0cmlidXRlPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfdmFsdWU6IERhdGU7XG5cbiAgICBjb25zdHJ1Y3Rvcih0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24sIGlpZDogc3RyaW5nLCB2YWx1ZTogRGF0ZSl7XG4gICAgICAgIHN1cGVyKHRyYW5zYWN0aW9uLCBpaWQpO1xuICAgICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldFZhbHVlKCk6IERhdGUge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0VHlwZSgpOiBQcm9taXNlPERhdGVUaW1lQXR0cmlidXRlVHlwZUltcGw+IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlKG5ldyBDb25jZXB0UHJvdG8uVGhpbmcuUmVxKCkuc2V0VGhpbmdHZXRUeXBlUmVxKG5ldyBDb25jZXB0UHJvdG8uVGhpbmcuR2V0VHlwZS5SZXEoKSkpO1xuICAgICAgICByZXR1cm4gRGF0ZVRpbWVBdHRyaWJ1dGVUeXBlSW1wbC5vZihyZXMuZ2V0VGhpbmdHZXRUeXBlUmVzKCkuZ2V0VGhpbmdUeXBlKCkpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZURhdGVUaW1lQXR0cmlidXRlSW1wbCB7XG4gICAgICAgIHJldHVybiBuZXcgUmVtb3RlRGF0ZVRpbWVBdHRyaWJ1dGVJbXBsKHRyYW5zYWN0aW9uLCB0aGlzLmdldElJRCgpLCB0aGlzLl92YWx1ZSk7XG4gICAgfVxufVxuIl19