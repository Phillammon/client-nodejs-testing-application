/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define("grakn-client/concept/schema/impl/RuleImpl", ["require", "exports", "graknlabs-grpc-protocol/protobuf/concept_pb", "graknlabs-grpc-protocol/protobuf/transaction_pb"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.RemoteRuleImpl = exports.RuleImpl = void 0;
    const concept_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/concept_pb"));
    const transaction_pb_1 = __importDefault(require("graknlabs-grpc-protocol/protobuf/transaction_pb"));
    class RuleImpl {
        constructor(label, when, then) {
            this._label = label;
            this._when = when;
            this._then = then;
        }
        static of(ruleProto) {
            return new RuleImpl(ruleProto.getLabel(), ruleProto.getWhen(), ruleProto.getThen());
        }
        getLabel() {
            return this._label;
        }
        getThen() {
            return this._then;
        }
        getWhen() {
            return this._when;
        }
        asRemote(transaction) {
            return new RemoteRuleImpl(transaction, this.getLabel(), this.getWhen(), this.getThen());
        }
        isRemote() {
            return false;
        }
        toString() {
            return `${this.constructor.name}[label:${this._label}]`;
        }
    }
    exports.RuleImpl = RuleImpl;
    class RemoteRuleImpl {
        constructor(transaction, label, when, then) {
            this._rpcTransaction = transaction;
            this._label = label;
            this._when = when;
            this._then = then;
        }
        getLabel() {
            return this._label;
        }
        getThen() {
            return this._then;
        }
        getWhen() {
            return this._when;
        }
        setLabel(label) {
            return __awaiter(this, void 0, void 0, function* () {
                yield this.execute(new concept_pb_1.default.Rule.Req().setRuleSetLabelReq(new concept_pb_1.default.Rule.SetLabel.Req().setLabel(label)));
                this._label = label;
            });
        }
        delete() {
            return __awaiter(this, void 0, void 0, function* () {
                yield this.execute(new concept_pb_1.default.Rule.Req().setRuleDeleteReq(new concept_pb_1.default.Rule.Delete.Req()));
            });
        }
        isDeleted() {
            return __awaiter(this, void 0, void 0, function* () {
                return !(yield this.rpcTransaction.concepts().getRule(this._label));
            });
        }
        asRemote(transaction) {
            return new RemoteRuleImpl(transaction, this.getLabel(), this.getWhen(), this.getThen());
        }
        isRemote() {
            return true;
        }
        execute(method) {
            const request = new transaction_pb_1.default.Transaction.Req().setRuleReq(method);
            return this._rpcTransaction.execute(request, res => res.getRuleRes());
        }
        get rpcTransaction() {
            return this._rpcTransaction;
        }
    }
    exports.RemoteRuleImpl = RemoteRuleImpl;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUnVsZUltcGwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9jb25jZXB0L3NjaGVtYS9pbXBsL1J1bGVJbXBsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQU9ILDZGQUF1RTtJQUN2RSxxR0FBK0U7SUFHL0UsTUFBYSxRQUFRO1FBTWpCLFlBQXNCLEtBQWEsRUFBRSxJQUFZLEVBQUUsSUFBWTtZQUMzRCxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztZQUNwQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztZQUNsQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUN0QixDQUFDO1FBRUQsTUFBTSxDQUFDLEVBQUUsQ0FBQyxTQUE0QjtZQUNsQyxPQUFPLElBQUksUUFBUSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDeEYsQ0FBQztRQUVELFFBQVE7WUFDSixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDdkIsQ0FBQztRQUVELE9BQU87WUFDSCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQztRQUVELE9BQU87WUFDSCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQztRQUVELFFBQVEsQ0FBQyxXQUF3QjtZQUM3QixPQUFPLElBQUksY0FBYyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQzVGLENBQUM7UUFFRCxRQUFRO1lBQ0osT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQztRQUVELFFBQVE7WUFDSixPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLFVBQVUsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQzVELENBQUM7S0FDSjtJQXZDRCw0QkF1Q0M7SUFFRCxNQUFhLGNBQWM7UUFNdkIsWUFBWSxXQUF3QixFQUFFLEtBQWEsRUFBRSxJQUFZLEVBQUUsSUFBWTtZQUMzRSxJQUFJLENBQUMsZUFBZSxHQUFHLFdBQTZCLENBQUM7WUFDckQsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7WUFDcEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDdEIsQ0FBQztRQUVELFFBQVE7WUFDSixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDdkIsQ0FBQztRQUVELE9BQU87WUFDSCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQztRQUVELE9BQU87WUFDSCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQztRQUVLLFFBQVEsQ0FBQyxLQUFhOztnQkFDeEIsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksb0JBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsa0JBQWtCLENBQUMsSUFBSSxvQkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDekgsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7WUFDeEIsQ0FBQztTQUFBO1FBRUssTUFBTTs7Z0JBQ1IsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksb0JBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxvQkFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3pHLENBQUM7U0FBQTtRQUVLLFNBQVM7O2dCQUNYLE9BQU8sQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDeEUsQ0FBQztTQUFBO1FBRUQsUUFBUSxDQUFDLFdBQXdCO1lBQzdCLE9BQU8sSUFBSSxjQUFjLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDNUYsQ0FBQztRQUVELFFBQVE7WUFDSixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBRVMsT0FBTyxDQUFDLE1BQTZCO1lBQzNDLE1BQU0sT0FBTyxHQUFHLElBQUksd0JBQWdCLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMxRSxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFFRCxJQUFjLGNBQWM7WUFDeEIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQ2hDLENBQUM7S0FDSjtJQXRERCx3Q0FzREMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHtcbiAgICBSZW1vdGVSdWxlLFxuICAgIFJ1bGUsXG4gICAgR3Jha24sIFJQQ1RyYW5zYWN0aW9uLFxufSBmcm9tIFwiLi4vLi4vLi4vZGVwZW5kZW5jaWVzX2ludGVybmFsXCI7XG5pbXBvcnQgQ29uY2VwdFByb3RvIGZyb20gXCJncmFrbmxhYnMtZ3JwYy1wcm90b2NvbC9wcm90b2J1Zi9jb25jZXB0X3BiXCI7XG5pbXBvcnQgVHJhbnNhY3Rpb25Qcm90byBmcm9tIFwiZ3Jha25sYWJzLWdycGMtcHJvdG9jb2wvcHJvdG9idWYvdHJhbnNhY3Rpb25fcGJcIjtcbmltcG9ydCBUcmFuc2FjdGlvbiA9IEdyYWtuLlRyYW5zYWN0aW9uO1xuXG5leHBvcnQgY2xhc3MgUnVsZUltcGwgaW1wbGVtZW50cyBSdWxlIHtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgX2xhYmVsOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfd2hlbjogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3RoZW46IHN0cmluZztcblxuICAgIHByb3RlY3RlZCBjb25zdHJ1Y3RvcihsYWJlbDogc3RyaW5nLCB3aGVuOiBzdHJpbmcsIHRoZW46IHN0cmluZykge1xuICAgICAgICB0aGlzLl9sYWJlbCA9IGxhYmVsO1xuICAgICAgICB0aGlzLl93aGVuID0gd2hlbjtcbiAgICAgICAgdGhpcy5fdGhlbiA9IHRoZW47XG4gICAgfVxuXG4gICAgc3RhdGljIG9mKHJ1bGVQcm90bzogQ29uY2VwdFByb3RvLlJ1bGUpOiBSdWxlSW1wbCB7XG4gICAgICAgIHJldHVybiBuZXcgUnVsZUltcGwocnVsZVByb3RvLmdldExhYmVsKCksIHJ1bGVQcm90by5nZXRXaGVuKCksIHJ1bGVQcm90by5nZXRUaGVuKCkpO1xuICAgIH1cblxuICAgIGdldExhYmVsKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sYWJlbDtcbiAgICB9XG5cbiAgICBnZXRUaGVuKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl90aGVuO1xuICAgIH1cblxuICAgIGdldFdoZW4oKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3doZW47XG4gICAgfVxuXG4gICAgYXNSZW1vdGUodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uKTogUmVtb3RlUnVsZSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVtb3RlUnVsZUltcGwodHJhbnNhY3Rpb24sIHRoaXMuZ2V0TGFiZWwoKSwgdGhpcy5nZXRXaGVuKCksIHRoaXMuZ2V0VGhlbigpKTtcbiAgICB9XG5cbiAgICBpc1JlbW90ZSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9W2xhYmVsOiR7dGhpcy5fbGFiZWx9XWA7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgUmVtb3RlUnVsZUltcGwgaW1wbGVtZW50cyBSZW1vdGVSdWxlIHtcbiAgICBwcml2YXRlIF9sYWJlbDogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3doZW46IHN0cmluZztcbiAgICBwcml2YXRlIHJlYWRvbmx5IF90aGVuOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfcnBjVHJhbnNhY3Rpb246IFJQQ1RyYW5zYWN0aW9uO1xuXG4gICAgY29uc3RydWN0b3IodHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uLCBsYWJlbDogc3RyaW5nLCB3aGVuOiBzdHJpbmcsIHRoZW46IHN0cmluZykge1xuICAgICAgICB0aGlzLl9ycGNUcmFuc2FjdGlvbiA9IHRyYW5zYWN0aW9uIGFzIFJQQ1RyYW5zYWN0aW9uO1xuICAgICAgICB0aGlzLl9sYWJlbCA9IGxhYmVsO1xuICAgICAgICB0aGlzLl93aGVuID0gd2hlbjtcbiAgICAgICAgdGhpcy5fdGhlbiA9IHRoZW47XG4gICAgfVxuXG4gICAgZ2V0TGFiZWwoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhYmVsO1xuICAgIH1cblxuICAgIGdldFRoZW4oKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RoZW47XG4gICAgfVxuXG4gICAgZ2V0V2hlbigpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2hlbjtcbiAgICB9XG5cbiAgICBhc3luYyBzZXRMYWJlbChsYWJlbDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZShuZXcgQ29uY2VwdFByb3RvLlJ1bGUuUmVxKCkuc2V0UnVsZVNldExhYmVsUmVxKG5ldyBDb25jZXB0UHJvdG8uUnVsZS5TZXRMYWJlbC5SZXEoKS5zZXRMYWJlbChsYWJlbCkpKTtcbiAgICAgICAgdGhpcy5fbGFiZWwgPSBsYWJlbDtcbiAgICB9XG5cbiAgICBhc3luYyBkZWxldGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuZXhlY3V0ZShuZXcgQ29uY2VwdFByb3RvLlJ1bGUuUmVxKCkuc2V0UnVsZURlbGV0ZVJlcShuZXcgQ29uY2VwdFByb3RvLlJ1bGUuRGVsZXRlLlJlcSgpKSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaXNEZWxldGVkKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gIShhd2FpdCB0aGlzLnJwY1RyYW5zYWN0aW9uLmNvbmNlcHRzKCkuZ2V0UnVsZSh0aGlzLl9sYWJlbCkpO1xuICAgIH1cblxuICAgIGFzUmVtb3RlKHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IFJlbW90ZVJ1bGUge1xuICAgICAgICByZXR1cm4gbmV3IFJlbW90ZVJ1bGVJbXBsKHRyYW5zYWN0aW9uLCB0aGlzLmdldExhYmVsKCksIHRoaXMuZ2V0V2hlbigpLCB0aGlzLmdldFRoZW4oKSk7XG4gICAgfVxuXG4gICAgaXNSZW1vdGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBleGVjdXRlKG1ldGhvZDogQ29uY2VwdFByb3RvLlJ1bGUuUmVxKTogUHJvbWlzZTxDb25jZXB0UHJvdG8uUnVsZS5SZXM+IHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IG5ldyBUcmFuc2FjdGlvblByb3RvLlRyYW5zYWN0aW9uLlJlcSgpLnNldFJ1bGVSZXEobWV0aG9kKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JwY1RyYW5zYWN0aW9uLmV4ZWN1dGUocmVxdWVzdCwgcmVzID0+IHJlcy5nZXRSdWxlUmVzKCkpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgcnBjVHJhbnNhY3Rpb24oKTogUlBDVHJhbnNhY3Rpb24ge1xuICAgICAgICByZXR1cm4gdGhpcy5fcnBjVHJhbnNhY3Rpb247XG4gICAgfVxufVxuIl19